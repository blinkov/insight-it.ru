<!DOCTYPE html>
<html lang=ru xmlns=http://www.w3.org/1999/xhtml xmlns:og=http://ogp.me/ns# xmlns:fb=https://www.facebook.com/2008/fbml><head><meta http-equiv=Content-Type content="text/html; charset=UTF-8"><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=msapplication-tap-highlight content=no><title>Клиентская часть интерактивного сайта</title><link href="//fonts.googleapis.com/css?family=Open+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=PT+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link rel=stylesheet href=https://www.insight-it.ru/theme/css/main.css?5e55de6b><link rel=canonical href=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ ><meta property=og:url content=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ ><meta property=og:title content="Клиентская часть интерактивного сайта"><meta property=og:type content=article><meta name=description content="Клиентская часть сайта играет ключевую роль в обеспечении его интерактивности. Именно на нее возлагается ..."><meta property=og:description content="Клиентская часть сайта играет ключевую роль в обеспечении его интерактивности. Именно на нее возлагается ..."><meta name=keywords content="AJAX,Backbone.js,CoffeeScript,JavaScript,JQuery,клиентская часть"><meta property=og:image content=https://www.insight-it.ru/images/interactive-clientside.jpg><meta name=author content="Иван Блинков"><meta property=og:site_name content="Insight IT"><meta property=og:locale content=ru_RU><link href=https://www.insight-it.ru/feed/index.xml type=application/rss+xml rel=alternate title="Insight IT RSS Feed"></head><body><header><div class=container><a href=# data-activates=nav-mobile class="button-collapse top-nav waves-effect waves-light circle"><i class=icon-menu></i></a></div><ul id=nav-mobile class="side-nav fixed"><li class=logo><a id=logo-container href=https://www.insight-it.ru/ class=brand-logo><h4>Insight IT</h4></a></li><li class=bold><a href=https://www.insight-it.ru/highload/ > Высокие нагрузки </a></li><li class=bold><a href=https://www.insight-it.ru/interactive/ > Интерактивные сайты </a></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Рубрики </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a href=https://www.insight-it.ru/category/index/ > Все рубрики </a></li></ul></div></li></ul></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Страницы </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/blog/ > Блог </a></li><li><a href=https://www.insight-it.ru/about/ > О сайте </a></li><li><a href=https://www.insight-it.ru/author/ > Об авторе </a></li><li><a href=https://www.insight-it.ru/consulting/ > Консультации </a></li><li><a href=https://www.insight-it.ru/contact/ > Контакты </a></li><li><a href=https://www.insight-it.ru/resume/ > Резюме </a></li><li><a href=https://www.insight-it.ru/search/ > Поиск по сайту </a></li></ul></div></li></ul></li></ul></header><main><nav class=top-nav><div class=container><div class=nav-wrapper><ul id=nav-mobile class="right hide-on-med-and-down"><li class><a href=/blog/ >Блог</a></li><li class><a href=/about/ >О&nbsp;сайте</a></li><li class><a href=/author/ >Об&nbsp;авторе</a></li></ul><h1><a class=page-title> Клиентская часть интерактивного сайта </a></h1></div></div></nav><div class=container><div class=row><div class="col s12 m9 l10"><div class="materialdesign section scrollspy"><section id=content class=body><article class=entry-content><div class=card><div class=card-image><img src=https://www.insight-it.ru/images/interactive-clientside.jpg alt="Клиентская часть интерактивного сайта" title="Клиентская часть интерактивного сайта" class=responsive-img></div></div><p>Клиентская часть сайта играет ключевую роль в обеспечении его&nbsp;<em>интерактивности</em>. Именно на нее возлагается переопределение стандартного поведения для создания впечатления живого организма вместо кучки бездушных страниц. В статье про <a href=https://www.insight-it.ru/interactive/2012/arkhitektura-interaktivnykh-sajjtov/ >архитектуру</a> интерактивных сайтов я подробно изложил основные функции и требования, которые перед ним стоят. Сегодня же я представлю свое видение того, как его грамотно реализовать. На статус единственно-правильного-решения не претендую, статью можно воспринимать просто как набор практических советов и рекомендаций. </p><p>Итак, сегодня мы будем обсуждать создание JavaScript-клиента для интерактивного сайта. Начнем, пожалуй, с организации кода проекта с целью облегчения его сопровождения при росте кодовой базы, перейдем к переопределению ключевых обработчиков событий, затем к сохранению стандартного поведения браузера и закончим синхронизацией состояния между клиентом и сервером.</p><h2 id=organizatsiia-koda>Организация кода</h2><h3 id=sborka>Сборка</h3><p>Первое, чем стоит обзавестись перед разработкой сложного JavaScript-приложения, это системой его сборки. С точки зрения клиентской оптимизации весь <a href=/tag/javascript/ >JavaScript</a>-код по возможности должен быть минифицирован и собран в один файл, подключенный в конце <a href=/tag/html/ >HTML</a>, желательно асинхронно. Работать с ним в таком виде невозможно, соответственно надо иметь возможность легко собирать его из набора красиво отформатированных файлов, используемых при&nbsp;разработке.</p><p>На вопрос <em>"Какую систему сборки использовать?"</em>&nbsp;в большинстве случаев правильный ответ: ту же, что и для сборки серверной части. Make, rake, maven, ant, rebar... - любому из них без труда можно поручить эту задачу. Для конкатенации можно использовать хоть консольную команду <code>&gt;&gt;</code>, для минимизации есть много альтернативных библиотек, в порядке моих симпатий:</p><ul><li><a href=https://www.insight-it.ru/goto/ec53b5fa/ rel=nofollow target=_blank title=https://developers.google.com/closure/compiler/ ><strong>Google Closure</strong></a></li><li><a href=https://www.insight-it.ru/goto/6ccc0709/ rel=nofollow target=_blank title=http://developer.yahoo.com/yui/compressor/ ><strong>YUI Compressor</strong></a></li><li><a href=https://www.insight-it.ru/goto/28795a57/ rel=nofollow target=_blank title=https://github.com/mishoo/UglifyJS><strong>UglifyJS</strong></a></li></ul><p>Если хочется чего-то более гибкого, могу порекомендовать воспользоваться <a href=https://www.insight-it.ru/goto/5908cea6/ rel=nofollow target=_blank title=https://github.com/miracle2k/webassets><strong>Webassets</strong></a>, который я уже упоминал в статье про <a href=https://www.insight-it.ru/python/2012/jinja2/ >Jinja2</a>. В консольном режиме прекрасно подключается к любой системе сборки и языку программирования. Описать процесс сборки <a href=/tag/javascript/ >JavaScript</a> и <a href=/tag/css/ >CSS</a> можно очень подробно и именно так, как считаете нужным, естественно на <a href=/tag/python/ >Python</a>. Сопоставимый по возможностям проект из мира <a href=/tag/ruby/ >Ruby</a> - <a href=https://www.insight-it.ru/goto/5b3a9a97/ rel=nofollow target=_blank title=http://synthesis.sbecker.net/pages/asset_packager>Asset Packager</a>, наверняка есть много других.</p><h3 id=chitabelnyi-kod>Читабельный код</h3><p>Не знаю как Вы, а я тихо ненавижу <strong>JavaScript</strong> все ~10 лет, которые я с ним знаком. Так как он по сути является монополией на рынке браузерных приложений (Flash, Java апплеты и ActiveX за альтернативы можно даже не считать), использовать его так или иначе приходится в любом сколько-либо серьезном интернет-проекте. Даже Google Dart&nbsp;вряд ли&nbsp;всерьез приживется.</p><p>При полном отсутствии конкуренции совершенно не удивительно, что у него никуда не годящийся синтаксис и набор не знаю откуда взявшихся абстракций в виде прототипов и замыканий. С этим всем определенно можно мириться и работать, особенно если только им и заниматься, но привыкший к серверным языкам программирования мозг определенно чувствует себя&nbsp;не комфортно.</p><p>Если Вас тоже не раз посещали подобные мысли, то Вы вероятно как и я при первой же возможности пересядете (или уже пересели) на <a href=/tag/coffeescript/ ><strong>CoffeeScript</strong></a>, компилируемый в JavaScript язык программирования.&nbsp;Немного рекламы этого проекта:</p><ul><li>Золотое правило CoffeeScript: <strong>"It's just Javascript"</strong><em>(это просто JavaScript)</em></li><li>Прямое преобразование кода в JavaScript</li><li>Доступны абсолютно все JavaScript-библиотеки</li><li>Никаких точек с запятой в конце каждой строки</li><li>Структурирование кода на основе отступов, как в Python</li><li>Объявление функций просто стрелочкой <code>-&gt;</code></li><li>При вызове методов даже скобки писать не обязательно</li><li><p>Человеческое наследование: простое <strong>class MyClass extends MyParent</strong>&nbsp;превращается в довольно хитрую конструкцию с использованием прототипов и замыканий:</p><div class=highlight><pre><span class=nx>MMyClass</span> <span class=o>=</span> <span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>__extends</span><span class=p>(</span><span class=nx>MyClass</span><span class=p>,</span> <span class=nx>MyParent</span><span class=p>);</span>
    <span class=kd>function</span> <span class=nx>MyClass</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>MyClass</span><span class=p>.</span><span class=nx>__super__</span><span class=p>.</span><span class=nx>constructor</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=k>this</span><span class=p>,</span>
            <span class=nx>arguments</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nx>MyClass</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>initialize</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{};</span>
    <span class=k>return</span> <span class=nx>MyClass</span><span class=p>;</span>
<span class=p>})();</span>
</pre></div></li><li><p>Много укороченных команд ветвления кода (<strong>if</strong>, <strong>switch,</strong> циклы&nbsp;и т.п.)</p></li><li>В целом код выходит раза в полтора-два короче и намного приятнее для глаз</li><li>Консольный компилятор с функцией наблюдения за директориями</li><li>Легко подключается как фильтр в Webassets</li><li>Подробнее с примерами на <a href=https://www.insight-it.ru/goto/834fa52/ rel=nofollow target=_blank title=http://coffeescript.org/ >официальном сайте</a></li><li>В общем рекомендую :)</li></ul><h3 id=logicheskoe-razdelenie-koda>Логическое разделение кода</h3><p>Если Вы сталкивались со сколько-либо сложным пользовательским интерфейсом "на jQuery", то скорее всего не по наслышке понимаете откуда взялось выражение <strong>"спагетти-код"</strong>. В связи с событийной парадигмой разработки браузерных приложений, очень часто JavaScript-код с использованием jQuery или альтернатив превращается в так называемый <em>"коллбек на коллбеке, коллбеком погоняет"</em> (коллбек - транслит от английского callback - обработчик события).&nbsp;При отсутствии четкой структуры такой код становится очень сложно поддерживать при его увеличении в объемах. Но это не повод отказываться от jQuery - от событий никуда не деться, и эта библиотека отлично справляется с абстракций от особенностей их реализации в различных браузерах.</p><p>На мой взгляд, одним из наиболее резонных способов решения (или заблаговременного предотвращения) этой проблемы является использование в разумных пределах <a href=/tag/oop/ >объектно-ориентированные</a>&nbsp;возможности <strong>JavaScript</strong><em>(благо CoffeeScript это дело сильно упрощает)</em>. Соответственно, используемые классы можно разумно располагать в какой-то иерархии с точки зрения наследования (для обеспечения DRY, don't repeat yourself - "не повторяйся") и с точки зрения расположения в файловой системе (с разложенными по папкам файлами работать намного проще, чем с здоровенной вереницей обработчиков событий в одном файле).</p><p>Собственно никто не мешает начать заворачивать код в классы на пустом месте, но я позволю себе предложить немного более элегантное решение, которое помимо организации кода пригодится нам и в дальнейшем. Подобно серверным фреймворкам, для клиентских приложений есть библиотеки, предоставляющие базовые классы для решения типичных задач:</p><ul><li><strong>Модель</strong>&nbsp;<em>(Model)</em> - как и в традиционном MVC представляет собой класс, объект которого содержит локальную копию каких-то данных и предоставляет механизмы для её синхронизации с внешним хранилищем. Основное отличие от серверных моделей - хранилищем выступает не СУБД, а либо локальное хранилище браузера через HTML5, либо удаленный сервис через REST или другой интерфейс. Плюс так как они находятся вне "зоны доверия", то полученные от них данные нужно обязательно валидировать, фильтровать и проверять на серверной стороне, прежде чем что-либо с ними делать.</li><li><strong>Представление</strong><em>(View)</em> или <strong>контроллер</strong><em>(Controller)</em> - тут, по моим впечатлениям, образовалась путаница и за обоими названиями в нашем контексте имеют ввиду примерно одно и то же. Объект такого класса следит за изменениями и событиями в связанных с ним моделях и элементах DOM, каким-либо образом на них реагируя. Таким образом большая часть кода, которая раньше была "вереницей обработчиков событий", оказывается методами этого класса. При этом базовый класс из библиотеки берет на себя нормальное поведение <strong>this</strong>&nbsp;и следит за тем, чтобы обработчики автоматически добавлялись на динамические созданные элементы DOM.</li><li><strong>Маршрутизатор</strong><em>(Router)</em>&nbsp;- следит за состоянием адресной строки и позволяет обрабатывать изменения, понадобится для восстановления поведения браузера.</li><li><strong>Коллекция</strong><em>(Collection)</em> - отсортированный набор однотипных моделей, с которым можно работать как с единым целым.</li></ul><div class="card blue lighten-4"><p><div class=card-content> Не стоит рассматривать эти абстракций как единственный верный способ делать клиентские приложения, но при их использовании появляется хоть какая-то логика и становится более-менее понятно где какой кусок кода должен находиться и где его потом искать. Для абстракции особенностей реализаций браузеров они по-прежнему полагаются на <code>$</code> в виде <a href=https://www.insight-it.ru/goto/3b02d98c/ rel=nofollow target=_blank title=http://jquery.com/ >jQuery</a> или <a href=https://www.insight-it.ru/goto/e6412e50/ rel=nofollow target=_blank title=http://zeptojs.com/ >Zepto</a>. </div></p></div><p>Мне известны три библиотеки, предоставляющие большую часть изложенных выше абстракций. Вкратце о каждой:</p><ul><li><a href=https://www.insight-it.ru/goto/e1e90fac/ rel=nofollow target=_blank title=http://documentcloud.github.com/backbone/ ><strong>Backbone.js</strong></a>&nbsp;- самая&nbsp;широко распространенная из трех, используется во многих серьезных проектах.&nbsp;Основана на библиотеке <a href=https://www.insight-it.ru/goto/48609b39/ rel=nofollow target=_blank title=http://documentcloud.github.com/underscore/ >Underscore.js</a>, которая с одной стороны предоставляет массу удобных функций и шаблонизатор, но с другой стороны - не особо-то и часто они оказываются нужны.</li><li><a href=https://www.insight-it.ru/goto/d7dc0253/ rel=nofollow target=_blank title=http://spinejs.com/ ><strong>Spine.js</strong></a>&nbsp;- библиотека по-моложе, которая очень похожа на Backbone.js, но написана на CoffeeScript и из-за отсутствия внешних зависимостей вышла компактнее. Отличия в основном в терминологии и деталях реализации.</li><li><a href=https://www.insight-it.ru/goto/a115abb7/ rel=nofollow target=_blank title=http://knockoutjs.com/ ><strong>Knockout.js</strong></a> - эта библиотека&nbsp;пропагандирует использование <code>data-*</code> атрибутов из HTML5 для хранения метаданных, которые как-то управляют изменениями тегов-владельцев при определенных событиях, практически забирая на себя роль представления. Концепция кажется мне мутноватой, так что лично для себя я её использование всерьез и не рассматривал никогда.</li></ul><p>Когда в этой статье дело будет доходить до примеров кода, я буду приводить их на основе <strong>Backbone.js</strong>, так как в свое время я остановился именно на ней. Почему? В основном из-за того, что она используется в очень многих проектах и стоит за ней целая компания, а не просто один разработчик, которому однажды может надоесть поддерживать проект (как в случае с Spine.js). Но в глубине души я, конечно, надеюсь, что однажды они уберут эту жесткую зависимость от Underscore.js, а то и может быть тоже перепишут все на CoffeeScript.</p><p>В целом я стараюсь изложить общую концепцию: те же принципы можно реализовать и с использованием альтернатив, и с использованием разрозненных библиотек, решающих более узкие задачи, и вообще с нуля, самостоятельно занимаясь вопросами кроссбраузерности и прочих особенностей современного Интернета. Последний путь, кстати, не настолько уж и безумен, как кажется, крупные компании и интернет-проекты обычно по нему и идут, если человеческие и финансовые ресурсы позволяют.</p><h2 id=obrabotchiki-sobytii_1>Обработчики событий</h2><p>В предыдущем разделе мы прилично так отвлеклись от основной темы - <em>интерактивных сайтов</em>. Это было необходимо для того, чтобы достаточно комплексное JavaScript-приложение в итоге оказалось поддерживаемым и имело хоть какую-то структуру и логику.</p><p>Напомню, то, что раньше было просто независимым обработчиком событий становится методом представления (по терминологии Backbone.js). У каждого представления создается "оглавление" методов-обработчиков в атрибуте <strong>events</strong>.&nbsp;Наверное многим хотелось бы увидеть какой-то пример кода, но так как статьями с примерами примитивных приложений на Backbone.js пестрит весь Интернет, тратить на это время желания совершенно никакого, сошлюсь на самый популярный: <a href=https://www.insight-it.ru/goto/fbd5c000/ rel=nofollow target=_blank title=http://documentcloud.github.com/backbone/docs/todos.html>список задач TODO</a>, для сравнения <a href=https://www.insight-it.ru/goto/28094239/ rel=nofollow target=_blank title=https://github.com/maccman/spine.todos>то же самое на Spine.js</a>.&nbsp;К слову, при использовании <em>CoffeeScript</em> использовать стандартный механизм <code>Backbone.****.extend({ ... })</code> не обязательно, <code>class MyClass extends Backbone.****</code> прекрасно делает то же самое.</p><p>По мне, так намного интереснее не какие именно события обрабатываются (все равно 90% уникальны для проекта), а как их распределить по разным представлениям. Обычно получается что-то в этом духе:</p><ul><li><strong>Пользовательское</strong> представление будет модифицировать страницу в тех местах, где оно как-то связано с текущим пользователем: форма авторизации, надпись "Привет, ****!", кнопка выхода и пр. Вероятно, оно будет использовать <em>модель</em> текущего пользователя или в тривиальных случаях просто самостоятельно работать с cookie сессии.</li><li>Классы <em>модели</em> и <em>представления</em>, а вероятно и <em>коллекции</em>, понадобятся каждой <strong>логической сущности</strong>, которая каким-либо образом отражается в пользовательском интерфейсе. Это может быть что угодно, например задача в TODO-списке, статья, комментарий - все зависит от тематики проекта.</li><li>Если <strong>навигация</strong> по сайту каким-то образом динамически видоизменяется, то представление понадобится и для нее. Например, часто подсвечивают пункты в глобальной навигации на основе изменений в текущем адресе страницы.</li><li>И, последний пункт, который собственно и относится к сегодняшней теме - одно представление будет общим для всего сайта и будет отвечать за его <strong>интерактивность</strong>. Давайте его рассмотрим подробнее.</li></ul><p>Для отсутствия перезагрузок браузера внутри сайта, нам нужно переопределить:</p><ul><li>События клика на ссылки: по содержимому атрибута <code>href</code> нужно определить, что ссылка внутренняя и вызвать "цепную реакцию" в других представлениях, чтобы в итоге пользователь увидел то, что должен.</li><li>При отправке формы есть два сценария:<ul><li>Обновляется связанная <em>модель</em> и синхронизируется с сервером. В таком сценарии при необходимости можно вообще скрыть кнопку отправки и "автосохранять" изменения в модели.</li><li>Связанной модели по каким-то причинам нет и нужно просто на основе данных формы что-то сделать, например выполнить поиск по указанной в форме фразе или отправить запрос на авторизацию.</li></ul></li><li>Для отмены стандартной реакции браузера на события у jQuery есть два основных механизма: <code>event.preventDefault()</code> и <code>return false</code>. В данной ситуации (да и большинстве других), целесообразнее пользоваться последним, так как если вдруг в коде обработчика окажется какая-то ошибка, то пользователь просто увидит стандартную реакцию браузера, а не окажется в ситуации "некликающихся ссылок" и "неотправляющихся форм".</li></ul><h2 id=vosstanovlenie-povedeniia-brauzera>Восстановление поведения браузера</h2><p>В предыдущем разделе я даже не стал подробно останавливаться на том, как сделать так "чтобы пользователь увидел то, что должен". Наверняка можно придумать массу способов решения этой задачи, но единственный реально применимый на практике - воспроизвести визуально то же самое, что происходит при обычной&nbsp;перезагрузке страницы.</p><p>И первое, с чего стоит начать - с адресной строки, именно там должен появиться тот адрес, который был в <code>href</code> ссылки и action формы. Но на самом деле проще сказать, чем сделать:</p><ul><li>Возможность просто полностью поменять текущий адрес в адресной строке из JavaScript без инициализации открытия страницы есть только в совсем свежих браузерах посредством <strong>HTML5 History API</strong> (<a href=https://www.insight-it.ru/goto/61b4e54f/ rel=nofollow target=_blank title=https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history#The_pushState().C2.A0method>pushState</a>).</li><li>В старых браузерах переходы между внутренними страницами сайта можно эмулировать через изменения якоря ссылки, который в URL идет после <code>#</code> и обычно используется для "перелистывания" на середину HTML-документа. Для отслеживания таких изменений используется событие <a href=https://www.insight-it.ru/goto/a35bb215/ rel=nofollow target=_blank title=https://developer.mozilla.org/en/DOM/window.onhashchange>onhashchange</a>.</li><li>В еще более старых браузерах это событие эмулируют разными трюками с iframe и setInterval.</li></ul><p><code>Backbone.history.start()</code>&nbsp;берет на себя абстракцию изменений в адресной строке, правда поддержку <em>pushState</em> нужно явно включить в аргументах. Заодно восстанавливается нормальное поведение кнопок "Назад" и "Вперед" в браузере.</p><p>Для обработки и создания событий, отражающихся в адресной строке, нужно сделать подкласс <strong>Backbone.Router</strong>. C ситуациями когда их имеет смысл создать несколько, я не сталкивался. По аналогии с серверными фреймворками в атрибуте <strong>routes</strong>&nbsp;задается соответствие паттернов адресов к методам-обработчикам, которые будут выполниться при переходе. В них вызываются необходимые изменения в коллекциях, моделях и представлениях, чтобы привести в нужное состояние текущий документ.</p><p>Для инициации "виртуального" перехода на новую внутреннюю страницу нужно вызвать метод <strong>navigate</strong> у нашего объекта-маршрутизатора, первым аргументом передав её адрес без первого /, а вторым - настройки:</p><ul><li><strong>trigger</strong> - вызывать ли обработчик из маршрутизатора?</li><li><strong>replace</strong> - добавлять ли страницу, с которой мы уходим в историю браузера, чтобы можно было на нее вернуться при нажатии кнопки "назад"?</li></ul><p>Таким образом, во внутренних ссылках мы используем нормальные относительные URL, начинающиеся с /. По ним будут нормально ходить роботы и браузеры без JavaScript. В обработчике кликов на них мы:</p><ul><li>проверяем правда ли она внутренняя (начинается ли она с /);</li><li>"отменяем" стандартный переход, вернув <code>false</code>;</li><li>вызываем <code>router.navigate(href.substring(1), {trigger: true})</code>.</li></ul><p>Осталась еще несколько атрибутов поведения браузера, которые необходимо починить, чтобы визуально все выглядело "как обычно":</p><ul><li>Клик по ссылке с зажатым Shift должен открывать её <em>в новом окне</em>, а с зажатым Ctrl или при клике средней кнопкой мыши - <em>в новой вкладке</em>. Довольно не хитро делается на основе атрибутов объекта-события, который передает обработчику jQuery (button, shiftkey, metakey), для открытия окна или вкладки - window.open.</li><li>Если пользователь сделал какое-то действие, а прореагировать на него мгновенно не получается (так как что-то грузится, вероятно) - нужно включить курсор ожидания, установив в CSS <strong>cursor: wait</strong>, и, желательно, анимированный <strong>favicon.ico</strong>. И, соответственно, вернуть все как было, когда страница примет нужный вид. Для смены favicon до сих пор пользуюсь каким-то довольно старым плагином к jQuery, который не особо шикарно, но все же работает. Его сайт, видимо, накрылся, так что продублировал:&nbsp;<a href=https://www.insight-it.ru/goto/d6f7fab3/ rel=nofollow target=_blank title=https://gist.github.com/2320740>https://gist.github.com/2320740</a>, если кто знает более адекватные альтернативы - дайте знать в комментариях, пожалуйста, руки поискать все никак не доходят.</li></ul><h2 id=sinkhronizatsiia-sostoianiia>Синхронизация состояния</h2><p>По-умолчанию Backbone.js предлагает хранить все состояние клиента в моделях и синхронизировать его с серверным посредством реализации простенького REST API на сервере (<a href=https://www.insight-it.ru/goto/e85f288a/ rel=nofollow target=_blank title=http://documentcloud.github.com/backbone/#Sync>подробнее</a>), к которому запросы отправляются посредством обычного <code>$.ajax</code>. Чтобы инициировать процесс нужно вручную вызвать у экземпляра модели метод <strong>fetch</strong>, чтобы обновить клиентское состояние данными с сервера, или метод <strong>save</strong>, для обратного процесса.</p><p>Для многих приложений этого, в целом, достаточно. Но ограничение очевидно - нет возможности мгновенно узнать, что на сервере что-то изменилось. Чего-то близкого можно достичь вызовом <strong>fetch</strong> раз в N секунд для каждой модели, но если пользователей предполагается хоть сколько-либо много, нагрузка на серверную часть будет неоправданно велика.</p><p>Резонным дополнением этой схемы является использование постоянного соединения между клиентом и сервером для синхронизации их состояний. Именно это мы и обсудим в следующей статье серии.</p><div class="card green"><p><div class="card-content white-text"> Эта статья - вторая в <a class="green-text text-lighten-4" href=https://www.insight-it.ru/interactive/ >серии про Интерактивные сайты</a>, автор - <a class="green-text text-lighten-4" href=https://www.insight-it.ru/goto/b03d9116/ rel=nofollow target=_blank title=http://blinkov.ru>Иван&nbsp;Блинков</a>, основано на личном опыте. До встречи <a class="green-text text-lighten-4" href=/feed/ >на страницах Insight IT</a>! </div></p></div><div class=sharrre-wrapper><div class=twitter data-url=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ data-text="Клиентская часть интерактивного сайта" data-title=Tweet></div><div class=facebook data-url=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ data-text="Клиентская часть интерактивного сайта" data-title=Like></div><div class=linkedin data-url=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ data-text="Клиентская часть интерактивного сайта" data-title="In Share" ></div></div><div class="card-panel light-blue darken-2 light-blue-text text-lighten-4"><span class=published title=2012-04-06T21:17:00+04:00>06 апреля 2012</span>&nbsp;|&nbsp;<span class="vcard author"><a class="url fn light-blue-text text-lighten-4" href=https://www.insight-it.ru/author/ > Иван Блинков </a></span>&nbsp;|&nbsp;<a href=https://www.insight-it.ru/category/interactive/ class="light-blue-text text-lighten-4" > Интерактивные сайты </a>&nbsp;|&nbsp;<a href=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/#comments class="light-blue-text text-lighten-4" title="41 комментариев"> 41 <i class=icon-chat></i></a></div><div class=taglist class=row><a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/ajax/ > AJAX </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/backbonejs/ > Backbone.js </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/coffeescript/ > CoffeeScript </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/javascript/ > JavaScript </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/jquery/ > JQuery </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/klientskaia-chast/ > клиентская часть </a>&ensp;</div></footer></article></section></div><div class=after><div id=comments><h4>41 комментариев</h4><ul class=comments-list><li class=comment><em>Николай Машков, 2014-08-11T15:51:29:<em> Спасибо за статью,вы могли бы порекомендовать как лучше организовать мультиязычность для Backbone.js ? </li><li class=comment><em>Aleksandr Yushchenko, 2014-05-27T13:11:40:<em> Привет! Интранет понятно. А как насчет интернета и поисковых роботов для таких сайтов. Спрошу на примере: допустим есть, какая то конкретная ссылка на товар и ресурс. Если мы попали на нее с другой страницы, то данные подгрузятся через ajax. А что насчет поисковых роботов, которые заходят по прямой ссылке и довольно плохо вроде как сканируют страницы с ajax. Кстати еще из плюсов таких сайтов - возможнсть встройки плеера с музыкой, которая постоянно играет, например) <ul class=children><li class=comment><em>Ivan Blinkov, 2014-05-27T14:32:58:<em> Это тоже относительно легко решается, описано в одной из следующих статей этой серии: http://www.insight-it.ru/progr...Если вкратце, то: имея на серверной стороне ручку, генерирующую данные, необходимые для отрисовки каждой страницы, и используя шаблонизатор, который может работать как в браузере, так и на сервере, то можно легко и безболезненно рендерить одну и ту же страницу как на сервере, даже при отключенном javascript, в т.ч. и для роботов, так и переходе с другой страницы сайта прямо в браузере без перезагрузки.При этом отрендеренную сервером страницу можно либо показывать вот прямо по правильному урлу, в том числе и живым только что пришедшим пользователям с JavaScript, либо только роботам по "левому" урлу согласно спецификации: https://developers.google.com/... Я обычно первый вариант предпочитаю. </li></ul></li><li class=comment><em>Sergey Onenko, 2012-09-12T20:36:32:<em> по поводу точек с запятными...Обязательно!аргументы:1) JSLint2) // мало? И вы плюете на читаемость вашего кода другими? вот кодvar foo = function(){ console.log(1);}(function(){ console.log(2);}());// Что выведет? "2" ?// вывод ==> 2 1// травите. <ul class=children><li class=comment><em>Deus, 2013-10-07T21:36:37:<em> Круто! 2,1 ! Без точки с запятой первая функция "думает", что ее вызвали с аргументом-фунцией! Вообще-то я ВСЕГДА ставлю точку с запятой </li></ul></li><li class=comment><em>Ruslan Prytula, 2012-08-15T21:51:44:<em> Backbone, вот недавно начал писать RIA на Backbone + requireJs,Как по мне requireJS доволи-таки не плохая библиотека(ни разу не было с ней проблем, в том числе и при минимизации в один файл)А вот про Backbone, к сожалению такого сказать не могу, ну хотя бы из-за1. Zombie Views2. Рендеринг (у себя реализовал рендеринг который делает одну вставку в дом) </li><li class=comment><em>zihotki, 2012-04-14T22:04:37:<em> К слову, Derik Baley сделал очень неплохую библиотеку для для написания большого приложения на основе backbone.js - backbone.marionette ( https://github.com/derickbaile... ) </li><li class=comment><em>Павлик, 2012-04-08T17:46:02:<em> Очень замечательно, что в статье упоминаются очень тонкие нюансы как cursor: wait;, синхронизация модели с обновлёнными данными на сервере и т.п. Если так пойдёт и дальше, то это будет один из самых полезных цикл статей про одностраничные сайты.Многие просили ссылки, из интересного, что я находил:https://github.com/tommoor/tin... - про фавиконhttps://github.com/thomasdavis... - про бекбонhttps://github.com/thomasdavis... - ещё про бекбони да, в ссылках выше не как нужно делать, а как можно делать <ul class=children><li class=comment><em>Ivan Blinkov, 2012-06-24T10:37:35:<em> Про фавиконку по Вашей ссылке пририсовывают цифру к статичной картинке (с кол-вом новых сообщение или писем), а в статье скорее нужен кроссбраузерный способ временно включать альтернативную GIF-анимацию. </li></ul></li><li class=comment><em>mrjj, 2012-04-07T14:04:27:<em> Я бы добавил несколько моментов из своего опыта, которые мне кажутся полезными.Кофе сейчас имеет проблемы с отладкой, если пишете аккуратно и можете прожить без полноценного отладчика - велком.backbone крайне скудно поддерживает иерархические модели и внешние ключи, их использование - это шаг на который нужно идти осознанно и прописывать механизм работы собственными руками. Так что не стоит полагать что получится красивая реплика селекта из реляционной БД.Механизм синхронизации Backbone лучше сразу брать под ручное управление. Также, бекбон не предполагает конвенций структуры приложения, ее желательно тоже продумывать зарание, ну хотя бы обозначив пространство имен.Также перед началом работы с ним стоит продумать точки синхронизации. Будет ли синхронизироваться стейт клиента целиком, или по отдельным виджетам, какие события будут запускать синхронизацию, какая будет возникать интенсивность запрсов.В начале объем кода на backbone.js, необходимого для создания тривиальной логики может не понравиться, но он начинает стабильно окупаться после преодоления клиентским кодом барьера в 1000 строк. Обычно классические сопли из коллбеков на jquery после этого порога отправляются на рефакторинг или рерайт.Документации к backbone и базовых примеров вам однозначно не хватит на создание изначально корректной структуры приложения, слишком много нюансов. Так что перед началом работы неплохо было бы вооружиться jsunpack и отправиться на реверс-инжиниринг сайтов его использующих в поисках примеров, многие из них приведены в конце документации.Отмечаю эти моменты потому что это грабли на которые наступал я и неоднократно, судя по группам, форумам и прямому общению с коллегами, наступают другие специалисты начиная его использовать.JS Фреймворки, да и в принципе клиентские фреймворки, пожалуй, имеет смысл классифицировать, так как многим может быть не совсем понятно какое место в их иерархии занимает backbone и его брат-близнец spine.При разработке js поощряет ад с пространством имен, скоупом и инклюдами, которые и хотелось бы заранее отговорить специалистов от использования решений вроде require.js которые являются жутким костылем-глюкодромом. Просто смиритесь, использовать привычные для большинства императивных ЯП инклюды не получится. Во многом с этим же связана очень специфическая работа интроспеккции js кода в большинстве IDE. <ul class=children><li class=comment><em>Павлик, 2012-04-08T17:33:27:<em> А не могли бы поподробней рассказать, почему require.js и представляемое им явное обозначение зависимостей через не желательны к использованию? На том же сервер-сайде сейчас активно идёт внедрение DI контейнеров и вытаскивание всех зависимостей наружу. Я понимаю, что это несколько иное, но направление, на мой взгляд, схожее. <ul class=children><li class=comment><em>mrjj, 2012-04-08T23:25:22:<em> Явное обозначение зависимостей это очень хорошо. Речь идет о require.js в клиентской среде.Если охота с ним воевать и его патчить - дело барское, а так мне уже попадалось неадекватное поведение с dojo, разными примочками с использованием jquery из тех что написаны несколько вилами, но не настолько, чтобы рефакторить. Когда используется несколько версий jquery (иногда требуется) тоже все не очень красиво получалось. Еще случалось что он дурит на плохом канале. Баги такого рода мерзкие и нестабильно всплывающие. Я обычно, принимая решение об использовании, рассматриваю два критерия - сырость и инвазивность свежего инструмента. Если он малоинвазивный, его использование не затрагивает существующий код, но сырой, то почему бы и не попробовать, будет несложно отказаться. Require.js и сырой и инвазивный. Под сыростью я подразумеваю, что неважно какой у него номер версии и статус последнего релиза, важно насколько часто он используется в продакшене. Инвазивность проявляется в том, что если в нем попадется фатальный баг, то процесс отката будет болезненным. До тестирования его поведения в различных браузерах дело так и не дошло, ничего сказать не могу.В итоге глобальный импорт и отмашка на инициализацию всего хозяйства разом по ready хоть и является дикостью, но предсказуемо работает как палка. С require процесс импорта повисат в асинхронных макаронах и импорт берется на ручной контроль. И на конце каждой макаронины нужно выяснить все ли прошло правильно и описать поведение если что-то пошло не так.Хотите иморт, допустим, клиентских шаблонов для backbone - извольте установить плагин уже к requirejs. Если представить это в уровнях абстракции, то это плагин к модулю импорта плагинов к плагину шаблонизатора одного фреймворка, который используется в MVC фреймворке, который... - конструкции такой высоты в реальном мире неустойчивы.Так что обычный но уродский глобальный импорт на клиентской части в моем хит-параде пока побеждает по надежности и предсказуемости. </li></ul></li></ul></li><li class=comment><em>Starkua, 2012-04-07T11:36:17:<em> В целом ваша статья полезная и объективная - кроме наезда на javascript. Это ведь ваше личное мнение, которое не разделяет огромное количество людей, не менее уважаемых чем вы. Я бы такие заявления убрал из статьи, т.к. это очень уж субъективно. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T12:47:28:<em> Эта серия статей изначально позиционировалась как просто мое мнение, на объективность не претендую ни капли.Если этот раздел про CoffeeScript - единственное, что в ней вызывает сомнения, то я очень польщен :) </li></ul></li><li class=comment><em>sgtpep, 2012-04-07T09:04:01:<em> Еще советую из клиентских фреймворков AngularJS – он декларативнее Backbone и лаконичнее KnockoutJS. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T12:57:57:<em> Не исключено, но тот факт что для его работы нужно использовать невалидный HTML и выдавать шаблоны прямо вперемешку с ним (которые, вероятно, при отключенном JS видны пользователям), практически ставит крест на этом проекте... <ul class=children><li class=comment><em>sgtpep, 2012-04-08T10:36:35:<em> Насчет невалидного HTML: в последней версии сделана попытка решить эту проблему, дав больше вариантов написания шаблонов (XHTML и HTML5): https://docs.google.com/docume... <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-09T15:01:03:<em> Они, конечно, молодцы, что пытаются это исправить, но сама концепция примешивания шаблонов и какой-либо логики в статичный HTML с моей точки зрения является неудачным архитектурным решением. </li></ul></li></ul></li></ul></li><li class=comment><em>Anton Ukolov, 2012-04-06T22:22:32:<em> Интересно, спс. Но спагетти не из-за того, что callback-стайл, а из-за неверного структуирования js-кода и проекта в целом. Кстати callback - это не обработчик события, неверное определение. <ul class=children><li class=comment><em>Konstantin Savelyev, 2012-04-09T10:04:18:<em> А что думаете о RxJS? </li><li class=comment><em>Ivan Blinkov, 2012-04-07T13:00:21:<em> Да, обработчик события дословно переводится как event handler и является частным случаем callback'a. Но в данном контексте они почти синонимы, так что я позволил себе использовать их в таком ключе. </li></ul></li><li class=comment><em>ActiveObject, 2012-04-06T20:16:48:<em> Хочу защитить JavaScript. Его обьектная модель другая, здесь упор зделан на делегирование вместо наследования, прототипы достаточно удобная концепция. Замыкания, функции высших порядков - это все от функциональной природы языка. Соглашусь, что долго программируя на С++, Java, PHP, трудно писать эфективный код на JavaScript. Но это возможно, и в большинстве случаев решение на JavaScript более выразительние и проще для понимания.Knockout.js реализирует модель MVVM, я б не ставил его на один уровень с Backbone, Spine, Ember. Он больше похож на низкоуровневое решение типа jQuery, тогда как остальные - каркасные решения для организации кода и реализации MVC паттерна. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T13:28:00:<em> Да, в том-то и дело что он просто другой. Это неприятно лишь когда ты работаешь 95% времени в какой-то другой парадигме, и время от времени приходится отвлекаться на JavaScript и заново вспоминать что там к чему. Хотя может это только у меня так... Не люблю надолго запоминать какие-то детали, которые всегда можно легко нагуглить.Knockout.js да, другой совсем, но задачи они более-менее общие решают, правда по-разному. </li><li class=comment><em>Anton Ukolov, 2012-04-06T22:18:04:<em> Да, согласен.JS сначала немного пугает своими объектами вызова, областями видимости, замыканиями и прототипным наследованием, но понимаешь, что все это неспроста =) </li></ul></li><li class=comment><em>Aleksey Zhurbitsky, 2012-04-06T19:30:49:<em> Очень интересно было бы посмотреть на исходные коды крупных проектов, основанных на такой или подобных архитектурах. Так сказать для перенятия опыта. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-06T19:34:05:<em> Для клиентского кода никто не мешает этого сделать, все публично доступно для скачивания, а из минифицированного состояния можно вновь вернуть читабельный вид.Список проектов, использующих Backbone.js: http://documentcloud.github.co... <ul class=children><li class=comment><em>Aleksey Zhurbitsky, 2012-04-06T19:53:48:<em> Спасибо за ссылку. Насчет клиентского кода - понятно что его можно просмотреть, но одно дело один большой минифицированный файл, а другое - наглядная структура проекта, конфиги сборщика, тот же coffeescript и т.д. В общем ищу опенсорс проект. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T13:10:48:<em> С этим да, сложнее, не слышал чтобы сколько-либо крупные проекты выкладывали исходники совсем целиком... </li></ul></li></ul></li></ul></li><li class=comment><em>Владимир Мацола, 2012-04-06T19:14:19:<em> шикарная статья! </li><li class=comment><em>Oleg Kandaurov, 2012-04-06T18:19:36:<em> Не знаю, где бы я еще нашёл подобную информацию, если не вы. Спасибо огромное! Небольшое пожелание: выкладывайте пожалуйста больше ссылок на полезные статьи. К примеру в рассказе про coffeescript было бы неплохо увидеть ссылку на внешний ресурс, который, как вы считаете, будет полезен к прочтению. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-06T18:57:59:<em> На здоровье!На единственную статью по CoffeeScript, которую я когда-либо читал, я дал ссылку, это главная страница оф. сайта. Все остальные по нему вопросы решаются обычно где-то на страницах StackOverflow.А насчет просто чужих статей, то в большинстве случаев они либо настолько хороши, что я их использую как источник информации и соответствующим образом ссылаюсь, либо особо внимания и не заслуживают.Хотя формат постов в виде сборников ссылок на других технических ресурсах пользуется популярностью, может быть и мне стоит задуматься. Правда я слишком неравномерно читаю, чтобы публиковать что-то подобное регулярно. </li></ul></li><li class=comment><em>Konstantin Goncharuk, 2012-04-06T17:46:00:<em> В интернетах ещё хвалят ember.js - он умеет то же, что и blackbone + биндится к интерфейсу и поддерживает вьюхи. Но фреймворк очень молодой, поэтому найти людей, сделавших на нем хоть один реальный проект, почти нереально. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-06T18:48:08:<em> Спасибо за дополнение. Посмотрел по диагонали - по мне так слишком большой упор сделан на шаблоны, они как-будто неотделимы в нем от логики. </li></ul></li><li class=comment><em>Dmitriy Pakhtinov, 2012-04-06T17:42:08:<em> Для управления историей можно использовать нативные методы, а использование Backbone не вижу для этого смысла. Почти все браузеры давно имеют поддержку нативного pushState/replaceState а если все же нужны старые браузеры, то лучше использовать эмуляторы. Которые просто добавляют эти самые методы браузеру. Тем самым не требуя изучать что-то новое. Посмотрите на это решение: https://github.com/devote/HTML... оно достаточно простое и не требует лишних изучений каких либо новых методов. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T13:33:42:<em> Да, есть где-то с десяток библиотек, которые делают только кроссбраузерную историю. С тем же успехом можно использовать и их.Backbone.js - в этой статье лишь в роли примера, в котором есть все, что нужно. </li></ul></li><li class=comment><em>Konstantin Goncharuk, 2012-04-06T17:33:17:<em> Немножко попридираюсь)"Никаких точек с запятой в конце каждой строки" - в джаваскрипте тоже не обязательно:alert('hello')alert('world')прекрасно работает <ul class=children><li class=comment><em>Илья w-495 Никитин, 2012-06-23T19:31:40:<em> Минимизация, таки, с этим не всегда справляется верно. </li><li class=comment><em>Александр Лозовюк, 2012-04-06T21:38:07:<em> А я не переношу когда в коде значимым является что-то невидимое и по дефолту принимаемое. То есть именно концепция питона и его отступов, а также отсутствие тех самых точки с запятой. К сожалению, автор столь уважаемого блога насаждает столь неправильную концепцию, жаль. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-07T13:15:56:<em> Перенос строки - вполне видимый и визуально заметный элемент текста, ровно как и отступ :)Даже в языках программирования, где обязательны дополнительные символы в конце строки и скобки, без нормальных отступов и переносов строк в нужных местах код превращается в нечитабельное месиво.В любом случае рассуждать в терминах "правильная - не правильная концепция" здесь некорректно, я прекрасно понимаю Вашу точку зрения и имею право на собственную. </li></ul></li><li class=comment><em>Ivan Blinkov, 2012-04-06T18:40:31:<em> Тем не менее, в JavaScript они в большинстве случае есть, а в CoffeeScript - нет. <ul class=children><li class=comment><em>dewid, 2013-05-06T13:01:31:<em> Ребя не забывайте плиз про Осла </li></ul></li></ul></li></ul></div><script type=text/javascript>
        var disqus_shortname = 'insight-it';
        var disqus_identifier = '1827 http://www.insight-it.ru/?p=1827';
        var disqus_url = 'https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/';
        var disqus_domain = 'disqus.com';
        var disqus_title = 'Клиентская часть интерактивного сайта';
        var disqus_container_id = 'comments';
        (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//insight-it.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script></div></div><div class="col hide-on-small-only m3 l2"><div class=card><a href=https://www.insight-it.ru/author><div class="card-image tooltipped" data-position=top data-delay=50 data-tooltip="Автор Insight IT"><img src=https://www.insight-it.ru/images/avatar.jpeg><span class=card-title>Иван Блинков</span></div></a></div><div class=toc-wrapper><div style="height: 1px;"><ul class="section table-of-contents"><li><a href=# title="Клиентская часть интерактивного сайта">Клиентская часть интерактивного сайта</a><li><a href=#organizatsiia-koda title="Организация кода">Организация кода</a><li><a href=#sborka title=Сборка>Сборка</a></li><li><a href=#chitabelnyi-kod title="Читабельный код">Читабельный код</a></li><li><a href=#logicheskoe-razdelenie-koda title="Логическое разделение кода">Логическое разделение кода</a></li></li><li><a href=#obrabotchiki-sobytii_1 title="Обработчики событий">Обработчики событий</a></li><li><a href=#vosstanovlenie-povedeniia-brauzera title="Восстановление поведения браузера">Восстановление поведения браузера</a></li><li><a href=#sinkhronizatsiia-sostoianiia title="Синхронизация состояния">Синхронизация состояния</a></li></li></ul></div></div></div></div></div></main><footer class=page-footer><div id=footer class=container><div class=row><div class="col m4 s12"><h5 class=white-text>Иван Блинков</h5><ul><li><a href=mailto:insight-it@blinkov.ru rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-mail white-text"></i> insight-it@blinkov.ru </span></a></li><li><a href=https://www.linkedin.com/in/ivanblinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-linkedin light-blue-text text-darken-3"></i> LinkedIn </span></a></li><li><a href=https://twitter.com/blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-twitter cyan-text text-accent-2"></i> @blinkov </span></a></li><li><a href="http://plus.google.com/102882395551389724078?rel=author" rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-gplus red-text"></i> Google </span></a></li><li><a href=https://www.facebook.com/ivan.blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-facebook blue-text text-darken-3"></i> Facebook </span></a></li><li><a href=https://www.insight-it.ru/feed/ rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-rss orange-text"></i> Подписаться по RSS </span></a></li></ul><a href=//feeds.feedburner.com/insight-it/feed target=_blank rel="external nofollow"><img src="//feeds.feedburner.com/~fc/insight-it/feed?bg=b3e5fc&amp;fg=222222&amp;anim=1" height=26 width=88></a>&nbsp;<a href=//twitter.com/blinkov target=_blank rel="external nofollow"><img src=//button.twittercounter.com/animated/blinkov/222222/b3e5fc width=88 height=26></a></div><div class="col m4 s12"><h5 class=white-text>Рубрики</h5><ul><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/highload/ > Высокие нагрузки </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/interactive/ > Интерактивные сайты </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/php/ > PHP </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/security/ > Безопасность </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/vacancy/ > Вакансии </a></li></ul><h5 class=white-text>Навигация</h5><ul><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/blog/ >Блог</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/about/ >О&nbsp;сайте</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/author/ >Об&nbsp;авторе</a></li></ul></div><div class="col m4 s12"><h5 class="white-text center-align">Теги</h5><div class="tagcloud taglist"><span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/programmirovanie/ > Программирование </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/meropriiatiia/ > мероприятия </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/masshtabiruemost/ > Масштабируемость </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/apache/ > Apache </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/informatsionnye-tekhnologii/ > информационные технологии </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/memcached/ > Memcached </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/internet/ > интернет </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/google/ > Google </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/mysql/ > MySQL </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/c/ > C++ </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/arkhitektura/ > архитектура </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hbase/ > HBase </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/tekhnologiia/ > технология </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/python/ > Python </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/javascript/ > JavaScript </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/oop/ > ООП </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/nginx/ > nginx </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/facebook/ > Facebook </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/highload/ > highload </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/php/ > PHP </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/razrabotka/ > разработка </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hadoop/ > Hadoop </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/online/ > online </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/linux/ > Linux </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/java/ > Java </a></span>&ensp;</div></div></div></div><div class=footer-copyright><div class=container> © Insight IT, 2008-2015 <a class="license right tooltipped" rel="license nofollow" target=_blank href=http://creativecommons.org/licenses/by-nc-nd/4.0/ data-position=top data-delay=50 data-tooltip="Все материалы опубликованы под лицензией Creative Commons Attribution-NonCommercial-NoDerivatives 4.0"><img alt="Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License" src=https://www.insight-it.ru/theme/images/license.png></a></div></div></footer><script src=//code.jquery.com/jquery-2.1.1.min.js></script><script src=https://www.insight-it.ru/theme/js/main.js?b5bb290d></script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js ','ga');
ga('create', 'UA-3403373-1', 'auto');
ga('send', 'pageview');
</script><script type=text/javascript>(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter30650472 = new Ya.Metrika({id:30650472, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src=//mc.yandex.ru/watch/30650472 style="position:absolute; left:-9999px;" alt></div></noscript></body></html>