<!DOCTYPE html>
<html lang=ru xmlns=http://www.w3.org/1999/xhtml xmlns:og=http://ogp.me/ns# xmlns:fb=https://www.facebook.com/2008/fbml><head><meta http-equiv=Content-Type content="text/html; charset=UTF-8"><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=msapplication-tap-highlight content=no><title>Постоянное соединение между браузером и сервером</title><link href="//fonts.googleapis.com/css?family=Open+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=PT+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link rel=stylesheet href=https://www.insight-it.ru/theme/css/main.css?5e55de6b><link rel=canonical href=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/ ><meta property=og:url content=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/ ><meta property=og:title content="Постоянное соединение между браузером и сервером"><meta property=og:type content=article><meta name=description content="В статье про клиентскую часть интерактивного интернет-проекта мы подошли к вопросу возможности использования ..."><meta property=og:description content="В статье про клиентскую часть интерактивного интернет-проекта мы подошли к вопросу возможности использования ..."><meta name=keywords content="AJAX,Comet,epoll,EventSource,Flash,HTTP,JavaScript,polling,streaming,WebSocket,клиентская часть,серверная часть,HTML5"><meta property=og:image content=https://www.insight-it.ru/images/browser-server-connection.jpg><meta name=author content="Иван Блинков"><meta property=og:site_name content="Insight IT"><meta property=og:locale content=ru_RU><link href=https://www.insight-it.ru/feed/index.xml type=application/rss+xml rel=alternate title="Insight IT RSS Feed"></head><body><header><div class=container><a href=# data-activates=nav-mobile class="button-collapse top-nav waves-effect waves-light circle"><i class=icon-menu></i></a></div><ul id=nav-mobile class="side-nav fixed"><li class=logo><a id=logo-container href=https://www.insight-it.ru/ class=brand-logo><h4>Insight IT</h4></a></li><li class=bold><a href=https://www.insight-it.ru/highload/ > Высокие нагрузки </a></li><li class=bold><a href=https://www.insight-it.ru/interactive/ > Интерактивные сайты </a></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Рубрики </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a href=https://www.insight-it.ru/category/index/ > Все рубрики </a></li></ul></div></li></ul></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Страницы </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/blog/ > Блог </a></li><li><a href=https://www.insight-it.ru/about/ > О сайте </a></li><li><a href=https://www.insight-it.ru/author/ > Об авторе </a></li><li><a href=https://www.insight-it.ru/consulting/ > Консультации </a></li><li><a href=https://www.insight-it.ru/contact/ > Контакты </a></li><li><a href=https://www.insight-it.ru/resume/ > Резюме </a></li><li><a href=https://www.insight-it.ru/search/ > Поиск по сайту </a></li></ul></div></li></ul></li></ul></header><main><nav class=top-nav><div class=container><div class=nav-wrapper><ul id=nav-mobile class="right hide-on-med-and-down"><li class><a href=/blog/ >Блог</a></li><li class><a href=/about/ >О&nbsp;сайте</a></li><li class><a href=/author/ >Об&nbsp;авторе</a></li></ul><h1><a class=page-title> Постоянное соединение между браузером и сервером </a></h1></div></div></nav><div class=container><div class=row><div class="col s12 m9 l10"><div class="materialdesign section scrollspy"><section id=content class=body><article class=entry-content><div class=card><div class=card-image><img src=https://www.insight-it.ru/images/browser-server-connection.jpg alt="Постоянное соединение между браузером и сервером" title="Постоянное соединение между браузером и сервером" class=responsive-img></div></div><p>В статье про <a href=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ >клиентскую часть интерактивного интернет-проекта</a> мы подошли к вопросу возможности использования двухстороннего постоянного соединения между сайтом и JavaScript-клиентом для синхронизации их состояний. Такое соединение представляет собой канал для обмена сообщениями <em>в реальном времени</em> между браузером и серверным процессом, причем каждая сторона может быть инициатором отправки сообщения и имеет некую логику реакции на получаемые сообщения.</p><p>Сегодня мы рассмотрим основные варианты реализации этого принципа и как он сочетается с обсуждавшимися в предыдущих статьях <a href=https://www.insight-it.ru/interactive/ >серии</a> темами.</p><h2 id=transport>Транспорт</h2><p>Так как одной из сторон постоянного соединения является браузер, вопрос кроссбраузерности при его реализации стоит не менее остро, чем, например, при верстке. В 2001 году, когда появился на свет самый часто вспоминаемый недобрым словом браузер в мире, о подобных технологиях постоянного соединения между браузером и сервером практически никто не задумывался даже отдаленно.</p><p>Существуют несколько протоколов и связанных с ними технологий, которые позволяют реализовать постоянное с точки зрения приложения соединение между браузером и сервером, обычно их называют <strong>транспортами</strong>. Каждый из них обладает разной производительностью, особенностями реализации и нагрузкой на серверную часть. Возможно не полный их список c краткими пояснениями:</p><ul><li><strong><a href=https://www.insight-it.ru/goto/5ddd244b/ rel=nofollow target=_blank title=http://ru.wikipedia.org/wiki/WebSocket>WebSocket</a>:</strong>&nbsp;пожалуй, самый эффективный с точки зрения производительности и нагрузки на сервер транспорт. Протокол относительно новый, появился в рамках работы над <a href=/tag/html5/ >HTML5</a>. Доступен только в очень свежих браузерах, имеет несколько более-менее стандартных версий. Используется одно соединение для обоих направлений обмена сообщениями.</li><li><strong><a href=https://www.insight-it.ru/goto/4587ee12/ rel=nofollow target=_blank title=http://dev.w3.org/html5/eventsource/ >EventSource</a>:</strong>&nbsp;появился примерно в то же время, что и WebSocket, но по задумке должен использоваться для получения односторонних уведомлений от сервера. В совокупности с простыми AJAX запросами для отправки событий из браузера может использоваться для двустороннего общения. Но так как он доступен примерно в тех же версиях браузеров, что и WebSocket, со сценариями, когда он оказывался бы более предпочтительным, я не сталкивался. Технически очень похож на следующий транспорт.</li><li><a href=https://www.insight-it.ru/goto/1a0e9c02/ rel=nofollow target=_blank title=http://en.wikipedia.org/wiki/Push_technology#HTTP_server_push><strong>AJAX Multipart</strong></a> aka <strong><a href=https://www.insight-it.ru/goto/1a0e9c02/ rel=nofollow target=_blank title=http://en.wikipedia.org/wiki/Push_technology#HTTP_server_push>HTTP Streaming</a>:</strong>&nbsp;после получения HTTP-запроса от клиента сервер не "отпускает" его и по мере поступления отправляет в него свои сообщения. Для отправки сообщений из браузера при необходимости создается&nbsp;второе соединение.</li><li><strong><a href=https://www.insight-it.ru/goto/dcd446e1/ rel=nofollow target=_blank title=http://en.wikipedia.org/wiki/Push_technology#Long_polling>AJAX/HTTP Polling</a>:</strong>&nbsp;в отличии от предыдущего транспорта, сервер закрывает HTTP-соединение после каждого отправленного в него сообщения или по прошествии определенного таймаута (обычно порядка 20-40 секунд). А браузер сразу же после получения сообщения открывает новое соединение, таким образом у сервера по-прежнему практически всегда есть соединение, куда можно отправить сообщения. Хоть по нагрузке на сервер этот вариант самый тяжелый, поддерживают его практически все браузеры.</li><li><strong><a href=https://www.insight-it.ru/goto/9344995a/ rel=nofollow target=_blank title=https://github.com/gimite/web-socket-js>Adobe Flash</a>:</strong>&nbsp;эта платформа может эмулировать поддержку WebSocket при определенном стечении обстоятельств (удачная комбинация Flash-плеера и браузера). Немного нетривиальна в настройке из-за своих особенностей.</li></ul><p>По поводу поддержки каждого из них различными браузерами было бы неплохо составить табличку, но на самом деле нюансов там много и многое зависит не только от версии браузера, но и от других обстоятельств, вроде наличия и типа прокси, использования трюков с iframe, наличия Flash-плеера и т.п.</p><p>Все вышеизложенные транспорты в конечном итоге основываются на протоколе <a href=/tag/http/ >HTTP</a>. Большинство из современных браузеров ограничивают количество одновременных HTTP-соединений с доменом <strong>до двух</strong>, что как раз достаточно даже для менее эффективных вариантов.</p><p>В любом случае работать напрямую с транспортами не обязательно, благо существует большое количество библиотек и сервисов, позволяющих от них абстрагироваться, к ним и переходим.</p><h2 id=abstraktsiia>Абстракция</h2><p>По сути такие библиотеки состоят из двух частей: клиентской на <a href=/tag/javascript/ >JavaScript</a> и серверной для одной или нескольких платформ. Клиент определяет какой из доступных в текущем браузере транспортов является наиболее эффективным и с его помощью устанавливает соединение с сервером, который поддерживает несколько протоколов. С точки зрения разработчика интерфейс, ими предоставляемый, не зависит от транспорта и примерно одинаков:</p><ul><li>Метод для <strong>отправки</strong> сообщения противоположной стороне.</li><li>Регистрация обработчика события, который будет вызван <strong>при получении</strong> сообщения от противоположной стороны, с содержанием сообщения в аргументе.</li><li>Метод, который будет вызван при установке и разрывании соединения.</li><li>Инициатором соединения по очевидным причинам всегда является клиент, так что у него есть дополнительный механизм для этого, с возможностью указать какие-то настройки.</li></ul><p>При выборе такой библиотеки для конкретного проекта очень большую роль играет его основная серверная платформа: обычно хочется использовать тот же язык программирования для обработки сообщений, что и для реализаций основной серверной части. Чаще всего используется основанный на <a href=/tag/epoll/ >epoll</a> или аналогах HTTP-сервер, что позволяет поддерживать большое количество пользователей онлайн:</p><ul><li><a href=/tag/node-js/ >Node.js</a> на <a href=/tag/javascript/ >JavaScript</a></li><li>На <a href=/tag/erlang/ >Erlang</a> есть несколько очень эффективных HTTP-серверов:<ul><li><a href=https://www.insight-it.ru/goto/82a43b29/ rel=nofollow target=_blank title=https://github.com/extend/cowboy>cowboy</a></li><li><a href=https://www.insight-it.ru/goto/4567a795/ rel=nofollow target=_blank title=https://github.com/ostinelli/misultin>misultin</a></li><li><a href=https://www.insight-it.ru/goto/2902d504/ rel=nofollow target=_blank title=https://github.com/mochi/mochiweb>mochiweb</a></li><li><a href=https://www.insight-it.ru/goto/798908e5/ rel=nofollow target=_blank title=http://yaws.hyber.org/ >yaws</a></li></ul></li><li><a href=/tag/tornado/ >Tornado</a>&nbsp;на <a href=/tag/python/ >Python</a></li><li><a href=/tag/netty/ >netty</a> на <a href=/tag/java/ >Java</a></li></ul><p>Так как самих библиотек этой категории существует примерно пару десятков, расскажу вкратце о наиболее заслуживающих внимания на мой взгляд:</p><ul><li><a href=https://www.insight-it.ru/goto/4034b77d/ rel=nofollow target=_blank title=http://socket.io>socket.io</a>: поддерживает практически все возможные транспорты, включая <a href=/tag/flash/ >Flash</a>. Основная серверная платформа - <strong>node.js</strong>, силами сторонних разработчиков есть реализации протокола на других платформах. Имеет спорную репутацию, проект довольно громоздкий, в некоторых ситуациях ведет себя непредсказуемо.</li><li><a href=https://www.insight-it.ru/goto/4dc9c4cc/ rel=nofollow target=_blank title=https://github.com/sockjs/sockjs-client>SockJS</a>: очень молодой проект, поддерживает необходимый минимум транспортов, прост в эксплуатации. Относительно стабилен и предсказуем. Серверная часть доступна на <strong>node.js</strong>, <strong>Tornado</strong> и <strong>cowboy/misultin,</strong> активно работают над другими платформами.</li></ul><p>Существуют коммерческие решения, абсолютно идентичные по принципу работы и функционалу. Аналогичная обсуждавшимся opensource решениям библиотека дополняется брокером сообщений для организации паттерна "публикация-подписка" и в совокупности с хостингом "в облаках" продается с оплатой за количество переданных сообщений (или по подписке с каким-то лимитом), естественно с нехилой наценкой. Плюсы и минусы очевидны: отсутствие необходимости обо всем этом заботиться против относительно высокой стоимости, потере контроля при сбоях или необходимости изменений, привязке к стороннему поставщику услуг и т.п. Рекламировать их не буду, при желании легко гуглятся, ровно как и оставшиеся альтернативные opensource проекты.</p><h2 id=vernemsia-k-interaktivnym-saitam>Вернемся к интерактивным сайтам</h2><p>Надеюсь, только что закончившегося лирического отступления на 3/4 статьи Вам будет достаточно, чтобы составить общее представление о построении постоянного соединения между браузером и сервером, а желательно и определиться с каким-то решением для автоматического выбора наиболее эффективного транспорта в контексте именно Вашего проекта.</p><p>Получив примитивный интерфейс в виде "отправить сообщение / отреагировать на сообщение" необходимо определиться с тем, что же мы будем передавать в этих сообщениях и как будем на них реагировать.</p><p>С форматом сериализации сообщений все довольно просто: выбор между XML и JSON очевиден в пользу последнего, а заморачиваться с чем-то более экзотическим смысла мало (хотя давно хочу попробовать в этой роли <a href=/tag/protocol-buffers/ >Protocol Buffers</a> или <a href=/tag/bson/ >BSON</a>, но никак руки не доходят).</p><p>Намного интереснее вопрос о том, что, собственно, будет в этих сообщениях содержаться. В <a href=https://www.insight-it.ru/interactive/2012/klientskaya-chast-interaktivnogo-sajjta/ >предыдущей статье</a> мы остановились на использовании фреймворка для организации кода JavaScript-клиента. Предлагаемая ими концепция <strong>модели</strong>&nbsp;обычно по-умолчанию предоставляет возможность синхронизации с сервером посредством <a href=/tag/ajax/ >AJAX</a> запросов и механизм изменения этого поведения. Для использовавшегося в качестве примера <a href=/tag/backbone-js/ >Backbone.js</a>&nbsp;для этого необходимо переопределить функцию <strong>Backbone.sync</strong>.&nbsp;При сохранении модели клиент будет отправлять объект с идентификатором модели и списком её изменений. Запрос изменений с сервера будет происходить асинхронно, то есть после отправки сообщения о том, что нужны данные для такой-то модели, посредством метода fetch он сам не получит ответа. Собственно изменения в модели произведет обработчик получения сообщений, в котором должна быть реализована соответствующая логика. Далее подписанные на события изменений в моделях объекты-представления будут соответствующим образом обновлять DOM-дерево страницы, отображая пользователю нужную информацию. <em>Это, пожалуй, наиболее <strong>правильный</strong> способ интегрировать постоянное соединение и клиентский фреймфорк.</em></p><p>Основными минусами его является очень серьезный объем работы по разработке клиентской части, а также дублирование достаточно большой части логики и HTML-шаблонов между серверной и клиентской сторонами. Я бы рекомендовал использовать этот подход, только если позволяют трудовые ресурсы (читай: есть хотя бы отдельный специализирующийся на JavaScript разработчик), либо когда проект по каким-то причинам решил отказаться от реализации статичного HTML-интерфейса.</p><p>В следующей статье я расскажу о менее трудозатратном способе добиться того же результата, который основан на жертве идеологической правильностью в пользу минимизации повторного написания кода.</p><div class="card green"><p><div class="card-content white-text"> Эта статья - третья в <a class="green-text text-lighten-4" href=https://www.insight-it.ru/interactive/ >серии про Интерактивные сайты</a>, автор - <a class="green-text text-lighten-4" href=https://www.insight-it.ru/goto/b03d9116/ rel=nofollow target=_blank title=http://blinkov.ru>Иван&nbsp;Блинков</a>, основано на личном опыте. До встречи <a class="green-text text-lighten-4" href=/feed/ >на страницах Insight IT</a>! </div></p></div><div class=sharrre-wrapper><div class=twitter data-url=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/ data-text="Постоянное соединение между браузером и сервером" data-title=Tweet></div><div class=facebook data-url=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/ data-text="Постоянное соединение между браузером и сервером" data-title=Like></div><div class=linkedin data-url=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/ data-text="Постоянное соединение между браузером и сервером" data-title="In Share" ></div></div><div class="card-panel light-blue darken-2 light-blue-text text-lighten-4"><span class=published title=2012-04-10T00:47:00+04:00>10 апреля 2012</span>&nbsp;|&nbsp;<span class="vcard author"><a class="url fn light-blue-text text-lighten-4" href=https://www.insight-it.ru/author/ > Иван Блинков </a></span>&nbsp;|&nbsp;<a href=https://www.insight-it.ru/category/interactive/ class="light-blue-text text-lighten-4" > Интерактивные сайты </a>&nbsp;|&nbsp;<a href=https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/#comments class="light-blue-text text-lighten-4" title="28 комментариев"> 28 <i class=icon-chat></i></a></div><div class=taglist class=row><a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/ajax/ > AJAX </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/comet/ > Comet </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/epoll/ > epoll </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/eventsource/ > EventSource </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/flash/ > Flash </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/http/ > HTTP </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/javascript/ > JavaScript </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/polling/ > polling </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/streaming/ > streaming </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/websocket/ > WebSocket </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/klientskaia-chast/ > клиентская часть </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/servernaia-chast/ > серверная часть </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/html5/ > HTML5 </a>&ensp;</div></footer></article></section></div><div class=after><div id=comments><h4>28 комментариев</h4><ul class=comments-list><li class=comment><em>Дмитрий, 2013-05-20T07:29:56:<em> для bb ync получается только запрашивает, а слушаем ответ мы вне ее? в коллекции данные запихиваем чем то вроде reset? </li><li class=comment><em>Артём, 2012-06-27T00:31:53:<em> Посоветуйте, пожалуйста, есть ли какие то "best practices" по протоколам обмена данными в уже открытом вэб-сокете? У меня web-приложение, соответственно различные его компоненты могут получать собщения от сервера по вэб-сокету. Как эффективнее организовать получение компонентами клиентской части только тех сообщений, которых они ожидают?Я пока-что использую JSON вида:{ "event": "taskStatus", "data": { "result": "failed", "url": "ya.ru", } }Т.е. передается ивент - каждый компонент проверяет если его интересует данный тип события то он парсит data, где собственно само сообщение. Пока такой формат вполне устраивает, но хотелось бы узнать есть ли какие-то более-менее стандартные формат обменаю <ul class=children><li class=comment><em>Ivan Blinkov, 2012-10-28T15:24:40:<em> Обычно все примерно так и делают. О чем-то еще более стандартном, чем JSON, не слышал. </li></ul></li><li class=comment><em>Илья w-495 Никитин, 2012-06-23T20:55:27:<em> AJAX/HTTP Polling: в отличии от предыдущего транспорта, браузер закрывает HTTP-соединениеs/браузер/cервер/?На Erlang есть несколько очень эффективных HTTP-серверов:misultin <- (по-моему, скорее мертв чем жив);yaws <- (по-моему, не очень-то эффективен, тяжеловат). <ul class=children><li class=comment><em>Ivan Blinkov, 2012-06-24T10:34:33:<em> "s/браузер/cервер/?" - ага, спасибо"misultin <- (по-моему, скорее мертв чем жив);" - да, изначальный автор его забросил в пользу cowboy, но так как им уже много кто пользуется - проект потихоньку развивается силами других участников сообщества. Например Richard Jones довольно активно что-то в нем пилит: https://github.com/RJ/misultin"yaws <- (по-моему, не очень-то эффективен, тяжеловат)." - я, если честно, не знаю какая сейчас у него ситуация; включил в список скорее по доброй памяти, так как в свое время впервые заинтересовался Erlang'ом когда наткнулся на вот эту статью: http://www.sics.se/~joe/apache... </li></ul></li><li class=comment><em>TheAthlete, 2012-05-19T10:15:32:<em> Для Perl есть следующие сервера:Corona - https://metacpan.org/module/Co...Starman - https://metacpan.org/module/St...Starlet - https://metacpan.org/module/St...Mojo::Server::Daemon - https://metacpan.org/module/Mo...Mojo::Server::Hypnotoad - https://metacpan.org/module/Mo...Twiggy - https://metacpan.org/module/Tw...HTTP::Server::Simple - https://metacpan.org/module/HT... <ul class=children><li class=comment><em>Ivan Blinkov, 2012-06-24T10:29:56:<em> Спасибо, Perl по-прежнему жив :) </li></ul></li><li class=comment><em>Александр Шибанов, 2012-05-10T10:41:39:<em> Иван, а такой вопрос - простой post - это какой вид транспорта? <ul class=children><li class=comment><em>Ivan Blinkov, 2012-05-10T10:44:39:<em> Сам по себе простой POST не может обеспечить постоянное двустороннее соединение между браузером и сервером, но он используется как часть некоторых из перечисленных транспортов (у которых есть AJAX в названии). <ul class=children><li class=comment><em>Александр Шибанов, 2012-05-10T11:47:20:<em> У нас просто такая проблема - некоторые страницы, долгое время остаются без действий пользователя, и сессия "протухает", после чего пользователя выбрасывает на страницу логина. Чтобы избежать этого, мы заставляем страницу раз в минуту посылать бессмысленный ajax запрос, чтобы сервер видел, что клиент жив.Собственно, хотелось узнать насколько это правильное\неправильное решение (на данный момент пользователей порядка 30 (не тысяч просто 30 :))) <ul class=children><li class=comment><em>Ivan Blinkov, 2012-05-10T11:59:43:<em> По идее выбрасывать на страницу логина должно только если браузер по какой-то причине не отправил cookie с идентификатором сессии, с ними точно все нормально?Бессмысленные HTTP-запросы - в любом случае плохо. Например в некоторых обсуждавшихся в этой статье подходах хоть и используется много "пустых" запросов, они не пропадают зря так как нужны, чтобы сервер в любой момент уведомить клиента о каком-то событии. <ul class=children><li class=comment><em>Александр Шибанов, 2012-05-10T13:00:04:<em> Иван, так вроде север убивает сессию? Браузер отсылает id уже мертвой сессии, и сервер его не пускает.Или достаточно увеличить время жизни кук? <ul class=children><li class=comment><em>Ivan Blinkov, 2012-05-10T13:27:02:<em> "Убивает" ли сервер сессию - полностью в Ваших руках, зависит от того где и как он их хранит. Если используете memcached, то да, сессии вероятно очищаются через сколько-то минут + вообще нет никаких гарантий то каждая конкретная не будет вытеснена. Но никто не мешает хранить их вечно или годами в каком-нибудь персистентном хранилище пар ключ-значение вроде Redis, Riak, Couchbase и.т.п. <ul class=children><li class=comment><em>Александр Шибанов, 2012-05-10T17:47:32:<em> Спасибо, Иван, вроде разобрались.А сервер у нас, Ваш "любимый" IIS :) </li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li><li class=comment><em>Haspadar, 2012-04-10T19:13:48:<em> Хотелось бы более подробной информации о Http Streaming. Серверная часть ничем не отличается в реализациях, а вот на клиенте их несколько. Самое кроссбраузерное решение - IFrame. Правда, побочный эффект - постоянная иконка лодинга на месте фавикона. А Multipart, насколько мне известно, поддерживается только FF. В общем, красивого решения этого метода я покуда не видел. Потому самые популярные методы - polling и long-polling. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-10T20:17:12:<em> Да, наиболее кроссбраузерный транспорт - polling, но ценой ему высокая нагрузка на серверную часть из-за очень большого количества HTTP-запросов от каждого пользователя.Именно для уменьшения нагрузки на сервер создаются клиенты, которые прибегают к нему лишь в крайнем случае, используя в современных браузерах более эффективные транспорты. <ul class=children><li class=comment><em>Andrey Mironov, 2012-04-11T15:06:03:<em> "Да, наиболее кроссбраузерный транспорт - polling, но ценой ему высокая нагрузка на серверную часть из-за очень большого количества HTTP-запросов от каждого пользователя."А в случае long polling разве не будет всего одно http-подключение для каждого пользователя? Чем тогда это лучше WebSocket? <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-11T16:26:11:<em> При long polling браузер постоянно открывает новые соединения с сервером одно за другим. Они обрываются либо когда серверу есть что отправить (он отправляет сообщение и закрывает соединение), либо по таймауту в десяток-другой секунд. Вслед за закрытым соединением браузер сразу же открывает новое такое же. Для отправки сообщения от браузера при этом используется простой AJAX.Websocket же да, представляет собой протокол для двустороннего обмена сообщениями в рамках одного HTTP-соединения. <ul class=children><li class=comment><em>Andrey Mironov, 2012-04-11T17:04:25:<em> А основная нагрузка на сервер разве не от того, что ему приходится поддерживать постоянное соединение одновременно со всеми пользователями, которые зашли на сайт, а не от того, что один пользователь периодически отправляет запрос один за другим? Одновременно то, во всех случаях получается количество открытых соединений такое же, сколько пользователей на сайте. И это не зависит от того, какая технология используется в качестве транспорта. Так ведь? <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-11T19:30:09:<em> Открытие HTTP-соединения - при любом раскладе далеко не бесплатная операция. При прочих равных (читай: количестве пользователей и сообщений) использование транспорта, открывающего меньше HTTP-соединений, будет потреблять меньше системных ресурсов.По поводу зависимости потребления ресурсов от количества пользователей онлайн могу сказать, что если серверная часть использует epoll (а это обычно именно так), то неактивные соединения системных ресурсов потребляют минимум.В конечном итоге, конечно, основной фактор, влияющий на серверную нагрузку данной подсистемы - суммарное количество передаваемых сообщений в единицу времени. Но в отрыве от конкретного проекта этот показатель практически не измерим. </li></ul></li></ul></li></ul></li></ul></li></ul></li><li class=comment><em>Kir S., 2012-04-10T16:42:59:<em> Хочу заметить, что в статье вы забыли рассказать о возможностях Faye: http://faye.jcoglan.com/. Это абстракция с бэкендами на Node.js и Ruby (можно выбрать любой). Использую уже не в одном проекте, очень интересный проект. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-10T20:29:40:<em> В этом проекте нет ничего особенного, кроме, может быть, поддержки publish/subscribe "из коробки" посредством Redis. Так что это просто одна из десятков других аналогичных библиотек, о которых я решил не рассказывать в статье.Хотя, насколько я слышал, Ruby-разработчикам именно она зачастую кажется привлекательной. </li></ul></li><li class=comment><em>Sukhanov Kirill, 2012-04-10T05:46:37:<em> А если выбирать из транспорта HTTP Streaming и Long-polling, какой из них лучше? Я понимаю, что ответ не однозначный, но все-таки, если надо поставить транспорты в порядке убывания(т.е. спускаемся на транспорт ниже, если текущий не доступен) - то какой из них поставить выше? <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-10T07:57:44:<em> Polling ниже, так как на каждое отправленное сервером сообщение открывается новое HTTP соединение, а при Streaming каждое соединение "многоразовое". </li></ul></li><li class=comment><em>mrjj, 2012-04-09T23:50:19:<em> Отличная статья, был бы рад прочитать ее в то время, когда разбирался в вопросе.Единственное, не стоит так плохо о злополучном браузере 2001 года, он благополучно почил и теперь можно спокойно относиться к его истории. Он, и его предыдущая версия как раз и положили начало XHR (если не брать в расчет java-апплеты), и над ним работали действительно хорошие программисты. Его предшественники буквально отбили рынок у mozilla. Была только одна маленькая деталь, о которой никто не задумался, - нормальная система обновления.Скорее всего через несколько лет, особенно если наконец все договорятся о поведении CS-XHR, окончательно исчезнет еще один исторический артефакт - транспорт на фреймах. Но до сих пор это вполне рабочий, надежный вариант, который можно встретить в коде. Кстати, кроссдоменный транспорт это достаточно богатая тема для того, чтобы при случае упомянуть о ней в паре абзацев, как с точки зрения построения этого транспорта, так и проблем безопасности которые в нем кроются. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-04-10T08:12:16:<em> Про систему обновления - в точку, если б MS могли насильно их всех обновить - мир определенно стал добрее и ярче :-)Кроссдоменный транспорт - да, тема интересная, но в контексте этой статьи не очень актуальная. А CS-XHR врядли так кардинально избавит от iframe'ов, так как до сих пор большая доля аудитории использует не самообновляющиеся браузеры. <ul class=children><li class=comment><em>Илья w-495 Никитин, 2012-06-23T21:34:52:<em> так как до сих пор большая доля аудитории использует не самообновляющиеся браузеры.Если про IE, то это не правда. Можно померяться статистикой. <ul class=children><li class=comment><em>Ivan Blinkov, 2012-06-24T10:25:15:<em> Я имел ввиду именно то, что там написано - браузеры, которые не умеют прозрачно для пользователя обновляться (в т.ч. Firefox кроме последних версий, Opera кажется туда же и пр.) </li></ul></li></ul></li></ul></li></ul></div><script type=text/javascript>
        var disqus_shortname = 'insight-it';
        var disqus_identifier = '1843 http://www.insight-it.ru/?p=1843';
        var disqus_url = 'https://www.insight-it.ru/interactive/2012/postoyannoe-soedinenie-mezhdu-brauzerom-i-serverom/';
        var disqus_domain = 'disqus.com';
        var disqus_title = 'Постоянное соединение между браузером и сервером';
        var disqus_container_id = 'comments';
        (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//insight-it.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script></div></div><div class="col hide-on-small-only m3 l2"><div class=card><a href=https://www.insight-it.ru/author><div class="card-image tooltipped" data-position=top data-delay=50 data-tooltip="Автор Insight IT"><img src=https://www.insight-it.ru/images/avatar.jpeg><span class=card-title>Иван Блинков</span></div></a></div><div class=toc-wrapper><div style="height: 1px;"><ul class="section table-of-contents"><li><a href=# title="Постоянное соединение между браузером и сервером">Постоянное соединение между браузером и сервером</a><li><a href=#transport title=Транспорт>Транспорт</a></li><li><a href=#abstraktsiia title=Абстракция>Абстракция</a></li><li><a href=#vernemsia-k-interaktivnym-saitam title="Вернемся к интерактивным сайтам">Вернемся к интерактивным сайтам</a></li></li></ul></div></div></div></div></div></main><footer class=page-footer><div id=footer class=container><div class=row><div class="col m4 s12"><h5 class=white-text>Иван Блинков</h5><ul><li><a href=mailto:insight-it@blinkov.ru rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-mail white-text"></i> insight-it@blinkov.ru </span></a></li><li><a href=https://www.linkedin.com/in/ivanblinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-linkedin light-blue-text text-darken-3"></i> LinkedIn </span></a></li><li><a href=https://twitter.com/blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-twitter cyan-text text-accent-2"></i> @blinkov </span></a></li><li><a href="http://plus.google.com/102882395551389724078?rel=author" rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-gplus red-text"></i> Google </span></a></li><li><a href=https://www.facebook.com/ivan.blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-facebook blue-text text-darken-3"></i> Facebook </span></a></li><li><a href=https://www.insight-it.ru/feed/ rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-rss orange-text"></i> Подписаться по RSS </span></a></li></ul><a href=//feeds.feedburner.com/insight-it/feed target=_blank rel="external nofollow"><img src="//feeds.feedburner.com/~fc/insight-it/feed?bg=b3e5fc&amp;fg=222222&amp;anim=1" height=26 width=88></a>&nbsp;<a href=//twitter.com/blinkov target=_blank rel="external nofollow"><img src=//button.twittercounter.com/animated/blinkov/222222/b3e5fc width=88 height=26></a></div><div class="col m4 s12"><h5 class=white-text>Рубрики</h5><ul><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/highload/ > Высокие нагрузки </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/interactive/ > Интерактивные сайты </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/php/ > PHP </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/security/ > Безопасность </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/vacancy/ > Вакансии </a></li></ul><h5 class=white-text>Навигация</h5><ul><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/blog/ >Блог</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/about/ >О&nbsp;сайте</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/author/ >Об&nbsp;авторе</a></li></ul></div><div class="col m4 s12"><h5 class="white-text center-align">Теги</h5><div class="tagcloud taglist"><span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/programmirovanie/ > Программирование </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/meropriiatiia/ > мероприятия </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/masshtabiruemost/ > Масштабируемость </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/apache/ > Apache </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/informatsionnye-tekhnologii/ > информационные технологии </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/memcached/ > Memcached </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/internet/ > интернет </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/google/ > Google </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/mysql/ > MySQL </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/c/ > C++ </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/arkhitektura/ > архитектура </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hbase/ > HBase </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/tekhnologiia/ > технология </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/python/ > Python </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/javascript/ > JavaScript </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/oop/ > ООП </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/nginx/ > nginx </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/facebook/ > Facebook </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/highload/ > highload </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/php/ > PHP </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/razrabotka/ > разработка </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hadoop/ > Hadoop </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/online/ > online </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/linux/ > Linux </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/java/ > Java </a></span>&ensp;</div></div></div></div><div class=footer-copyright><div class=container> © Insight IT, 2008-2015 <a class="license right tooltipped" rel="license nofollow" target=_blank href=http://creativecommons.org/licenses/by-nc-nd/4.0/ data-position=top data-delay=50 data-tooltip="Все материалы опубликованы под лицензией Creative Commons Attribution-NonCommercial-NoDerivatives 4.0"><img alt="Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License" src=https://www.insight-it.ru/theme/images/license.png></a></div></div></footer><script src=//code.jquery.com/jquery-2.1.1.min.js></script><script src=https://www.insight-it.ru/theme/js/main.js?b5bb290d></script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js ','ga');
ga('create', 'UA-3403373-1', 'auto');
ga('send', 'pageview');
</script><script type=text/javascript>(function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter30650472 = new Ya.Metrika({id:30650472, webvisor:true, clickmap:true, trackLinks:true, accurateTrackBounce:true}); } catch(e) { } }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); } })(document, window, "yandex_metrika_callbacks");</script><noscript><div><img src=//mc.yandex.ru/watch/30650472 style="position:absolute; left:-9999px;" alt></div></noscript></body></html>