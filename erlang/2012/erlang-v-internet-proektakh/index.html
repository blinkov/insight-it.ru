<!DOCTYPE html>
<html lang=ru xmlns=http://www.w3.org/1999/xhtml xmlns:og=http://ogp.me/ns# xmlns:fb=https://www.facebook.com/2008/fbml><head><meta http-equiv=Content-Type content="text/html; charset=UTF-8"><meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=msapplication-tap-highlight content=no><title>Erlang в интернет-проектах</title><link href="//fonts.googleapis.com/css?family=Open+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=PT+Sans&amp;subset=latin,cyrillic" rel=stylesheet type=text/css><link rel=stylesheet href=https://www.insight-it.ru/theme/css/main.css?5e55de6b><link rel=canonical href=https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/ ><meta property=og:url content=https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/ ><meta property=og:title content="Erlang в интернет-проектах"><meta property=og:type content=article><meta name=description content="С моей точки зрения, Erlang - один из наиболее продуманных языков программирования. Его создатели выбирали каждую ..."><meta property=og:description content="С моей точки зрения, Erlang - один из наиболее продуманных языков программирования. Его создатели выбирали каждую ..."><meta name=keywords content=Beam,DETS,Erlang,ERTS,ETS,EVM,Mnesia,OTP,VM><meta property=og:image content=https://www.insight-it.ru/images/erlang.jpeg><meta name=author content="Иван Блинков"><meta property=og:site_name content="Insight IT"><meta property=og:locale content=ru_RU><link href=https://www.insight-it.ru/feed/index.xml type=application/rss+xml rel=alternate title="Insight IT RSS Feed"></head><body><header><div class=container><a href=# data-activates=nav-mobile class="button-collapse top-nav waves-effect waves-light circle"><i class=icon-menu></i></a></div><ul id=nav-mobile class="side-nav fixed"><li class=logo><a id=logo-container href=https://www.insight-it.ru/ class=brand-logo><h4>Insight IT</h4></a></li><li class=bold><a href=https://www.insight-it.ru/highload/ > Высокие нагрузки </a></li><li class=bold><a href=https://www.insight-it.ru/interactive/ > Интерактивные сайты </a></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Рубрики </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a href=https://www.insight-it.ru/category/index/ > Все рубрики </a></li></ul></div></li></ul></li><li class=no-padding><ul class="collapsible collapsible-accordion"><li class=bold><a class="collapsible-header waves-effect waves-red"> Страницы </a><div class=collapsible-body><ul><li><a href=https://www.insight-it.ru/blog/ > Блог </a></li><li><a href=https://www.insight-it.ru/about/ > О сайте </a></li><li><a href=https://www.insight-it.ru/author/ > Об авторе </a></li><li><a href=https://www.insight-it.ru/consulting/ > Консультации </a></li><li><a href=https://www.insight-it.ru/contact/ > Контакты </a></li><li><a href=https://www.insight-it.ru/resume/ > Резюме </a></li><li><a href=https://www.insight-it.ru/search/ > Поиск по сайту </a></li></ul></div></li></ul></li></ul></header><main><nav class=top-nav><div class=container><div class=nav-wrapper><ul id=nav-mobile class="right hide-on-med-and-down"><li class><a href=/blog/ >Блог</a></li><li class><a href=/about/ >О&nbsp;сайте</a></li><li class><a href=/author/ >Об&nbsp;авторе</a></li></ul><h1><a class=page-title> Erlang в интернет-проектах </a></h1></div></div></nav><div class=container><div class=row><div class="col s12 m9 l10"><div class="materialdesign section scrollspy"><section id=content class=body><article class=entry-content><div class=card><div class=card-image><img src=https://www.insight-it.ru/images/erlang.jpeg alt="Erlang в интернет-проектах" title="Erlang в интернет-проектах" class=responsive-img></div></div><p>С моей точки зрения,&nbsp;<a href=https://www.insight-it.ru/goto/4b2ebe6b/ rel=nofollow target=_blank title=http://www.erlang.org><strong>Erlang</strong></a> - один из наиболее продуманных языков программирования. Его создатели выбирали каждую деталь и особенность реализации так, чтобы сделать его идеальным для решения вполне конкретных телекоммуникационных задач, с которыми они сталкивались в 80-90-х годах. Во многом из-за этого он так и не стал универсальным языком программирования как <a href=/tag/c/ >C++</a>, <a href=/tag/python/ >Python</a> и другие, а так и остался спустя многие годы специализированным инструментом. Сегодня спрос и предложение на специалистов по <a href=/tag/erlang/ >Erlang</a> на рынке труда относительно малы, что для большинства проектов является основным аргументом <em>против Erlang</em>, хотя порой они и сталкиваются с задачами, где он запросто бы стал тем самым <em>"идеальным инструментом"</em>. В этой статье я хотел бы обсудить, в каких именно ситуациях применительно к интернет-проектам использование <strong>Erlang</strong> оправдано и почему. Но начать придется издалека - с того, чем же он так <em>уникален</em>. </p><h2 id=chto-takoe-erlang>Что такое Erlang?</h2><p>Под словом Erlang обычно подразумевают совокупность сразу нескольких компонентов:</p><ul><li>Сам одноименный язык программирования - по сути синтаксис и идеологию;</li><li><strong>ERTS</strong><em>(Erlang Run-Time System)</em> - реализация всех низкоуровневых абстракций на <a href=/tag/c/ >C</a>. Подробнее о них ниже.</li><li><strong>BEAM</strong><em>(Bogdans' Erlang Abstract Machine)</em> - стандартная реализация виртуальной машины, с помощью которой обычно исполняются программы на Erlang после компиляции в байт-код (она очень эффективна; хотя компиляция Erlang в нативный код и возможна, оно того чаще всего не стоит). BEAM используется по-умолчанию в основных дистрибутивах <a href=/tag/linux/ >Linux</a> и других операционных системах. Когда говорят "виртуальная машина Erlang" обычно подразумевается совокупность ERTS и BEAM.</li><li><strong>OTP</strong><em>(Open Telecom Platform)</em> - набор качественно реализованных высокоуровневых абстракций, использование которых стало почти стандартом де-факто в мире Erlang, так как оно позволяет не изобретать велосипеды и избегать типичных ошибок при реализации типичных же паттернов. Немного забегая вперед, приведу несколько примеров:&nbsp;<strong>gen_server</strong> (просто процесс, который принимает какие-то запросы и как-то на них реагирует), <strong>gen_fsm</strong> (конечный автомат), <strong>supervisor</strong> (мониторинг других процессов).</li></ul><h2 id=kliuchevye-osobennosti>Ключевые особенности</h2><ul><li><strong>Параллельное программирование</strong><em>(concurrent programming)</em> - программы на Erlang состоят из независимых задач, которые <em>могут</em> выполняться параллельно, что на практике дает свободу виртуальной машине планировать их выполнение наиболее эффективным образом с учетом доступных системных ресурсов.</li><li><strong>Процессная модель</strong><em>(process model)</em> - единицей параллельного выполнения в Erlang является <em>процесс</em>, который технически представляет собой лишь часть потока исполнения <em>(thread)</em> операционной системы и обладает нижеизложенными свойствами, которые обеспечивает их реализация в ERTS:<ul><li><strong>Параллельность</strong><em>(concurrency)</em> - каждый процесс выполняет свою часть кода вне зависимости от других процессов, со своим темпом.</li><li><strong>Изоляция процессов</strong><em>(process isolation)</em>&nbsp;- в отличии от потоков исполнения в операционных системах и других языках программирования, между процессами Erlang'а нет общей памяти. Помимо этого сбой в одном из процессов напрямую не влияет на другие процессы в системе. Именно по-этому они называются <em>процессами</em>, так как в этом ключе скорее похожи на полноценные процессы операционной системы.</li><li><strong>Низкое потребление ресурсов</strong>&nbsp;<em>(low resource consumption)</em> - так как процессы Erlang являются лишь абстракцией внутри потока исполнения операционной системы, используют зачастую <em>меньше килобайта</em> оперативной памяти и требует минимальных вычислительных ресурсов, то один сервер может при необходимости иметь сотни тысяч и даже миллионы&nbsp;запущенных процессов (теоретически возможный максимум - 268435456, хотя по-умолчанию стоит ограничение в&nbsp;32768 процессов). Для сравнения: суммарное количество потоков выполнения на сервере обычно измеряется сотнями и редко превышает тысячу.</li><li><strong>Слабая связанность</strong>&nbsp;<em>(loose coupling)</em> - процессы общаются друг с другом посредством асинхронного обмена сообщениями <em>(message passing)</em>,&nbsp;для чего часть памяти каждого процесса выделяется под "почтовый ящик". При отправке сообщения в списке входящих сообщений процесса-получателя создается копия сообщения, составленного в процессе-отправителе. При этом протокол отправки сообщений между процессами скрыт от разработчика и не зависит от того, находится ли получатель в той же виртуальной машине или в удаленной (на другом сервере), что позволяет легко и практически прозрачно распределять приложения по многим физическим серверам <em>(горизонтальное масштабирование, scale out)</em>.</li><li><strong>Дерево ответственности</strong><em>(responsibility tree)</em> - создаваемые внутри системы процессы образуют иерархию, где родители несут ответственность за потомков.&nbsp;В упомянутом чуть выше примере сбой одного из процессов вызывает его завершение и рассылку уведомлений связанным процессам-соседям по иерархии (с информацией о том, где и почему произошел сбой), на которые они могут как-то реагировать. Типичных сценария реагирования два: также завершить работу и разослать аналогичные уведомления, вызывая цепную реакцию (такие процессы называют исполнителями, <em>worker</em>), либо на основе уведомления принять какое-то действие, например попытаться заново запустить часть дерева процессов, аналогичную остановленной (такие называют надсмотрщиками, <em>supervisor</em>). Использование этого механизма позволяет приложению добиться <em>отказоустойчивости</em>.</li></ul></li><li><strong>Ссылочная прозрачность</strong><em>(referential transparency)</em>&nbsp;- как только переменная получила какое-то значение его уже нельзя изменить <em>(single assignment)</em>, для нового значения нужно заводить новую переменную. На первый взгляд выглядит полным бредом, но именно эту цену нужно заплатить для гарантии того, что какая-то другая часть кода втихаря не "испортит" значение. Плюс отсутствие изменений в структурах данных в памяти дает большую свободу для применения различных оптимизаций компилятору, сборщику мусора и планировщику процессов.</li><li><strong>Планировщик процессов</strong><em>(scheduler)</em> - виртуальная машина Erlang с точки зрения операционной системы выглядит как один процесс с несколькими потоками исполнения <em>(threads)</em>, каждый из которых имеет собственный планировщик, управляющий группой Erlang-процессов. Процессы могут прозрачно перемещаться из одного потока в другой для <em>балансировки нагрузки</em>. Помимо этого планировщик берет на себя управление вводом-выводом, которые на низком уровне реализованы в неблокирующей, основанной на событиях, манере с использованием&nbsp;<a href=/tag/epoll/ >epoll</a>&nbsp;или аналогов, но для конечного разработчика представляется в упрощенном виде.</li><li><strong>Сборщик мусора в памяти</strong><em>(garbage collector)</em> - в отличии от других виртуальных машин (в частности <a href=/tag/jvm/ >JVM</a>) сборка мусора в Erlang не влечет за собой значимых задержек в работе приложений, так как благодаря изоляции процессов для сборки мусора они останавливаются по очереди, пока все остальные продолжают работать. Обычно область памяти выделенная под один процесс очень невелика (для сравнения: под новый процесс в Erlang выделяется около 1 килобайта, под новый поток исполнения в <a href=/tag/java/ >Java</a> - более 512 килобайт в зависимости от реализации), так что сборка мусора для каждого процесса не занимает много времени. Планировщик может определить какие процессы нужно пропустить при очередной сборке мусора, если они не исполнялись с момента предыдущей сборки. Если процесс создается для выполнения кратковременной задачи, то он может успеть сделать свое дело и завершиться без единой сборки мусора, полностью освободив свою память по окончании работы.</li><li><strong>Функциональное программирование</strong>&nbsp;<em>(functional programming)</em>&nbsp;- если рассмотреть один Erlang-процесс внутри, отбросив его связь с внешним миром (обмен сообщениями), то можно увидеть программу, полностью соответствующую функциональной парадигме: алгоритмы выражаются в виде вызовов функций, которые, в свою очередь, являются единицами данных наравне с числами и сложными структурами. На практике же это означает другой стиль программирования и используемые абстракции (рекурсия вместо циклов, поведения вместо интерфейсов и т.п.), по сравнению с более распространенными <a href=/tag/oop/ >объектно-ориентированными</a> языками; подробно это будет интересно лишь программистам, так что оставим это для другой статьи про <a href=/tag/erlang/ >Erlang</a>.</li><li>Доступно три механизма хранения данных вне памяти процессов:<ul><li><strong>ETS</strong><em>(erlang term storage)</em> - очень похожий на хранилище пар ключ-значение механизм, работающий в оперативной памяти самой виртуальной машины и доступный всем или части её процессов (есть ограничения доступа). Данные хранятся в пространствах имен (таблицы без жесткой структуры), а доступ осуществляется по ключу, который являются частью значения (обычно первым элементом в хранящейся структуре данных).</li><li><strong>DETS</strong>&nbsp;<em>(disk erlang term storage)</em>&nbsp;- предоставляется аналогичный ETS интерфейс и формат хранения данных, с той лишь разницей, что данные хранятся в файлах на диске, а не в памяти виртуальной машины. При использовании <strong>не</strong>твердотельных дисков операции поиска данных значительно медленнее аналогов из модуля ETS.</li><li><strong>Mnesia</strong> - полноценная СУБД на основе ETS/DETS, с поддержкой атомарных транзакций <em>(atomic transactions)</em>, репликации <em>(replication)</em> и партиционирования <em>(sharding)</em>. Позволяет абстрагироваться от физического расположения данных, осуществлять поиск/выборки данных в реальном времени, а также вносить изменения в конфигурацию и схему данных без перезапуска.</li></ul></li><li><strong>Горячее обновление кода</strong><em>(hot code loading)</em> - виртуальная машина может держать в памяти и параллельно выполнять две версии одного и того же кода (единицей измерения здесь является <em>модуль</em>, то есть один скомпилированный файл исходного кода), процесс переключается со старого кода на новый при выполнении <em>внешнего</em> вызова к одной из его функций (что в целом полностью в руках разработчика). Эта возможность позволяет полностью избежать недоступности приложения при обновлениях, что очень важно для всех приложений, работающих в реальном времени, к которым также относятся все сайты и интернет-сервисы.</li></ul><h2 id=primenenie-na-praktike>Применение на практике</h2><p>Телекоммуникации и Интернет на сегодняшний день хоть и являются совершенно разными областями <em>информационных технологий</em>, но все же глобальная цель у них общая: позволять людям легко общаться удаленно. Предлагаю вернуться к изначальной теме статьи: в каких конкретно ситуациях <strong>Erlang</strong>, вместе со своими изложенными выше особенностями и ограничениями, может оказаться уместным решением задач интернет-проекта? Примеры могут показаться субъективными, так что с удовольствием готов обсудить их и другие ситуации в комментариях.</p><h3 id=vkhodiashchie-polzovatelskie-soedineniia>Входящие пользовательские соединения</h3><p>Еще в далеком 2002 году в сети часто мелькал сравнительный&nbsp;<a href=https://www.insight-it.ru/goto/669f1a19/ rel=nofollow target=_blank title=http://www.sics.se/~joe/apachevsyaws.html>бенчмарк</a>&nbsp;<strong>Apache</strong><em>(C)</em> и <strong>Yaws</strong><em>(Erlang)</em>&nbsp;по обработке HTTP-запросов, где Yaws представлялся "победителем" с огромным отрывом. С тех пор конечно же многое поменялось, появился стремительно набирающий обороты <a href=/tag/nginx/ >nginx</a> и "популярные в узких кругах" решения вроде <a href=/tag/node-js/ >node.js</a> или <a href=/tag/tornado/ >Tornado</a>.</p><p>Но <strong>Erlang</strong> тоже не стоит на месте. Благодаря целенаправленной работе по оптимизации ERTS в целом и планировщика процессов в частности, современные реализации HTTP-серверов на Erlang по-прежнему легко <a href=https://www.insight-it.ru/goto/fdb93d75/ rel=nofollow target=_blank title=http://www.ostinelli.net/a-comparison-between-misultin-mochiweb-cowboy-nodejs-and-tornadoweb>дают фору</a>&nbsp;более распространенным решениям.</p><p>В последние годы появляется все больше интернет-проектов, использующие постоянные соединения <em>(websocket, long polling, etc.)</em>&nbsp;между браузером и HTTP-сервером для обновления страниц сайта в реальном времени. Здесь также Erlang легко справляется с задачей, так как для поддержания постоянного соединения обычно используется лишь 1 Erlang-процесс (хотя иногда 2), которые, как уже упоминалось, потребляют минимум &nbsp;оперативной памяти и вычислительных ресурсов. Как следствие, HTTP-сервер на Erlang способен поддерживать очень постоянное соединение с онлайн пользователями, даже если их количество измеряется десятками тысяч.</p><p>Хочется отметить, что в этом примере речь идет именно об обработке соединений с пользователями, то есть внутри HTTP-сервера минимум логики, он просто "разбирает" запрос и, вероятно, передает его дальше внутрь системы через брокер сообщений или напрямую внутренним сервисам. К вопросу с сколько-либо сложной бизнес-логикой вернемся чуть позже.</p><h3 id=otdacha-statiki>Отдача статики</h3><p>Для отдачи статики в Erlang часто используют тот же системный вызов <strong>sendfile</strong>, что и в <a href=/tag/nginx/ >nginx</a>.&nbsp;Но на практике ситуация здесь неоднозначна:</p><ul><li>прямой доступ к sendfile через встроенные вызовы&nbsp;<em>(BIF, Built-In Functions)</em>&nbsp;появился в Erlang только в самом последнем на сегодняшний день релизе - R15B;</li><li>раньше использовалась <a href=https://www.insight-it.ru/goto/e9f4e5cf/ rel=nofollow target=_blank title=https://github.com/tuncer/sendfile>обертка</a>&nbsp;с использованием нативных функций <em>(NIF, native implemented functions)</em>&nbsp;или просто чтение файла, что <a href=https://www.insight-it.ru/goto/317549c0/ rel=nofollow target=_blank title=http://www.erlang-factory.com/upload/presentations/71/JoeWilliams-Web_Server_Deathmatch.pdf>работало не очень хорошо</a>.</li></ul><div class="card blue lighten-4"><p><div class=card-content> На готовые бенчмарки по отдаче статики из последних версий Erlang'а я не натыкался, так что могу предложить взглянуть на небольшой тест <strong>cowboy</strong> vs <strong>nginx</strong>&nbsp;на обычном домашнем оборудовании: Ubuntu в роли сервера, iMac в роли клиента (JMeter), 100Мбит между ними. Какого-либо тюнинга настроек не производилось. </div></p></div><ul><li><p>1.1Мб картинка в 10 потоков <em>(нехитрая математика говорит о том, что все упираются в сеть)</em>:</p><ul><li><a href=https://www.insight-it.ru/images/cowboy-static.jpg>Cowboy без sendfile</a>: 853мс. в среднем, 639 запросов в минуту, отклонение 428мс.</li><li><a href=https://www.insight-it.ru/images/cowboyR15B-static.jpg>Cowboy с sendfile</a>: 853мс. в среднем, 639 запросов в минуту, отклонение 395мс.</li><li><a href=https://www.insight-it.ru/images/nginx-static.jpg>Nginx</a>: 882мс. в среднем, 638 запросов в минуту, отклонение 515мс.</li></ul></li><li><p>112б текстовый файл в 1000 потоков:</p><ul><li><a href=https://www.insight-it.ru/images/cowboy-static2.jpg>Cowboy без sendfile</a>: 37мс. в среднем (но медиана - 3мс., то есть небольшая часть запросов сильно тормозит, а с остальной все нормально), 259 тыс. запросов в минуту, отклонение 234мс.</li><li><a href=https://www.insight-it.ru/images/cowboyR15B-static.jpg>Cowboy с sendfile</a>: 17 мс. в среднем, 267 тыс. запросов в минуту, отклонение 27мс.</li><li><a href=https://www.insight-it.ru/images/nginx-static2.jpg>Nginx</a>: 2мс. в среднем, 315 тыс. запросов в минуту, отклонение 3мс.</li></ul></li></ul><p>Не претендуя на хоть на какую-либо точность и применимость в боевых условиях, эти цифры и графики показывают, что&nbsp;в деле отдачи статики <strong>nginx</strong>&nbsp;хоть и по-прежнему лидер, но в не-экстремальных ситуациях особой разницы можно и не заметить. Хотя при использовании решений на Erlang определенно можно начать "скучать" по нестандартным конфигурациям nginx с какой-нибудь компрессией на лету, rewrite'ами и пр. В любом случае, для отдачи статики в сколько-либо серьезных интернет-проектов рекомендую пользоваться услугами&nbsp;<a href=/tag/cdn/ >CDN</a>.</p><h3 id=balansirovka-nagruzki>Балансировка нагрузки</h3><p>Откровенно говоря, я не слышал о каком-либо проекте на Erlang для балансировки HTTP и/или TCP запросов, хотя бы отдаленно сравнимом по возможностям, надежности и производительности с <a href=/tag/haproxy/ >HAProxy</a> и "железными" решениями.</p><p>Хотя по мне так сами свойства Erlang прекрасно подходят для решения этой задачи, но те проекты, на которые я натыкался (<a href=https://www.insight-it.ru/goto/53f5a8f4/ rel=nofollow target=_blank title=https://github.com/mdaguete/tcpbalance>пример</a>), выглядят просто как "поделки" по сравнению с проверенными временем решениями.</p><p>В любом случае HTTP/TCP балансировщик нагрузки на Erlang - отличная тема для нового opensource проекта, если вдруг кому-то нечем заняться в свободное время :)</p><h3 id=broker-soobshchenii>Брокер сообщений</h3><p>В статье про <strong><a href=https://www.insight-it.ru/erlang/2012/rabbitmq/ >RabbitMQ</a></strong>&nbsp;я уже подробно рассказывал о том, как Erlang вписывается в роль <em>брокера сообщений</em>, то есть посредника между различными компонентами системы, обеспечивающего их слабую связанность путем обмена сообщениями.</p><p>В дополнение хочется сказать, что хоть изобретать велосипед и редко когда оказывается хорошей затеей, Erlang отлично подошел бы и для реализации собственной схемы обмена сообщениями внутри системы, например без использования централизованного брокера, как это в итоге получается с использованием RabbitMQ или аналогов.</p><h3 id=biznes-logika>Бизнес-логика</h3><p>Этот аспект является практически уникальным от проекта к проекту, так что здесь придется ограничиться лишь какими-то общими рекомендациями.</p><p>Основной слабой стороной Erlang является <strong>обработка данных</strong>, в частности:</p><ul><li>Текстовые строки в Erlang реализованы как <em>однонаправленный</em>&nbsp;<em>связанный список целых чисел</em>, то есть на каждый символ выделяется <strong>восемь байт</strong> памяти: четыре на код символа, четыре - на указатель на следующий символ; плюс еще четыре байта для указателя на начало списка. Для 64-битных систем эти цифры нужно удвоить, так как машинное слово вдвое длиннее. Помимо неоправданных расходов памяти, эта схема усложняет различные операции со строками, например чтобы посчитать длину строки нужно "пройтись" по ней целиком. А чтобы приписать один символ в конец строки, нужно сделать её полную копию (для записи в начало это не так, как не трудно догадаться).</li><li>Бинарные строки хранятся в памяти последовательно, так что объем не удваивается из-за указателей. Изменения в итоге также создают копии данных, что для больших строк накладно. В любом случае там где это возможно я бы рекомендовал использовать бинарные строки вместо текстовых.</li><li>С математическими задачами все не так плачевно: хоть и реализация базовых операций в виртуальной машине несколько отстает по производительности от чистого <a href=/tag/c/ >С</a>, при желании его можно практически догнать средствами нативной компиляции, грамотной реализации алгоритма и отсутствия "палок в колесах" у компилятора. Альтернативный сценарий: использование NIF.</li></ul><p>Для не-англоязычных проектов трудностью может оказаться довольно сомнительная <a href=https://www.insight-it.ru/goto/2568aa73/ rel=nofollow target=_blank title=http://www.erlang.org/doc/apps/stdlib/unicode_usage.html>поддержка Unicode</a>: особого типа данных нет, в тех же текстовых строках код символа может выходить за пределы таблицы ASCII (не зря же на него 32 или 64 бита выделили), а в бинарных строках можно хранить что угодно, в т.ч. и Unicode-текст. Как прореагирует на Unicode тот или иной встроенный модуль или используемая библиотека никто не гарантирует, но обычно все более-менее нормально.</p><p>Хоть на самом деле это и является роскошью, но при реализации бизнес-логики на Erlang порой недостает ORM-подобных механизмов в духе "вытащил объект из базы, поменял в нем что-нибудь, положил обратно". Не то чтобы таких библиотек нет, просто эта схема не очень хорошо "ложится" на функциональную парадигму и реализуется обычно через не особо предназначенные для этого механизмы словарей <em>(dict)</em> или именованных кортежей <em>(record)</em>.</p><p>В качестве резюме хочется сказать, что на <strong>Erlang</strong> можно реализовать бизнес-логику практически любого интернет-проекта. Просто если она сложнее, чем просто передать какие-то данные от одного пользователя другому, то вероятно из-за&nbsp;искусственных&nbsp;ограничений и недостаточной выразительности языка для эффективной её разработки на Erlang может потребоваться существенно больше времени и усилий, чем на более приспособленных для этого языках вроде <a href=/tag/ruby/ >Ruby</a>, <a href=/tag/php/ >PHP</a> и <a href=/tag/python/ >Python</a>.</p><h3 id=bazy-dannykh>Базы данных</h3><p>Здесь все довольно просто: обычно <strong>Erlang</strong> используется как распределенная надстройка над встраиваемыми <a href=/tag/subd/ >СУБД</a>&nbsp;или особыми форматами файлов. Основные представители:&nbsp;<a href=https://www.insight-it.ru/goto/2a0c794c/ rel=nofollow target=_blank title=http://basho.com/products/riak-overview>Riak</a>&nbsp;<em>(Google LevelDB)</em>,&nbsp;<a href=https://www.insight-it.ru/goto/4cab48f4/ rel=nofollow target=_blank title=http://couchdb.apache.org>CouchDB</a>&nbsp;<em>(свой формат)</em>,&nbsp;<a href=https://www.insight-it.ru/goto/5d81862f/ rel=nofollow target=_blank title=http://www.erlang.org/doc/man/mnesia.html>Mnesia</a>&nbsp;<em>(DETS)</em>,&nbsp;<a href=https://www.insight-it.ru/goto/2d0bf326/ rel=nofollow target=_blank title=http://www.couchbase.com>Couchbase</a>&nbsp;<em>(memcached и SQLite)</em> - все совершенно разные, обсуждать и сравнивать можно до бесконечности, так что оставим это на другой раз.</p><p>Из общих особенностей вышеперечисленных решений можно выделить:</p><ul><li>Прозрачная <em>горизонтальная масштабируемость</em>;</li><li>Настраиваемый уровень <em>репликации</em> данных;</li><li>Обычно <em>доступность</em> и <em>персистентность</em> в ущерб строгой целостности (AP из CAP-теоремы);</li><li>Поддержка <em>сложных распределенных выборок</em> (<a href=/tag/mapreduce/ >MapReduce</a>, многокритериальная фильтрация,&nbsp;полнотекстный&nbsp;поиск и т.п., за исключением Couchbase)</li><li>Способность легко справляться с большим <em>потоком изменений данных</em> (за исключением, пожалуй, CouchDB);</li><li>Отсутствие строгой схемы данных и SQL-подобного интерфейса.</li></ul><h2 id=podvodim-itogi_1>Подводим итоги</h2><p><strong>Erlang</strong> в умелых руках может послужить и правда удачным решением для реализации многих аспектов интернет-проектов, благодаря качественной, проверенной временем, основе в виде виртуальной машины и OTP, а также продуманной модели легковесных процессов. <em>В результате получаются высокопроизводительные, горизонтально масштабируемые приложения, полностью приспособленные для стабильной бесперебойной работы в боевых условиях.</em></p><p>Высокий барьер обучения специалистов по-прежнему остается весомым аргументом "против", но если в проекте команда разработчиков уровня выше среднего -&nbsp;вряд ли&nbsp;это станет серьезным препятствием. Недостаток "готовых" квалифицированных специалистов по Erlang на трудовом рынке также не особо радует, но ситуация определенно постепенно улучшается.</p><p>В комментариях предлагаю обсудить по каким еще причинам на сегодняшний день Erlang столь редко можно увидеть в технологическом стеке интернет-проектов? Какие еще вопросы смущают руководство и разработчиков? В каких ситуациях преодоление сложностей и ограничений, связанных с Erlang, того стоит?</p><p><em>Эта статья определенно будет далеко не последней про Erlang, так что если эта тема Вам близка - рекомендую <a href=/feed/ >подписаться на RSS</a>.</em></p><div class=sharrre-wrapper><div class=twitter data-url=https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/ data-text="Erlang в интернет-проектах" data-title=Tweet></div><div class=facebook data-url=https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/ data-text="Erlang в интернет-проектах" data-title=Like></div><div class=linkedin data-url=https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/ data-text="Erlang в интернет-проектах" data-title="In Share" ></div></div><div class="card-panel light-blue darken-2 light-blue-text text-lighten-4"><span class=published title=2012-03-17T19:43:00+04:00>17 марта 2012</span>&nbsp;|&nbsp;<span class="vcard author"><a class="url fn light-blue-text text-lighten-4" href=https://www.insight-it.ru/author/ > Иван Блинков </a></span>&nbsp;|&nbsp;<a href=https://www.insight-it.ru/category/erlang/ class="light-blue-text text-lighten-4" > Erlang </a></div><div class=taglist class=row><a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/beam/ > Beam </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/dets/ > DETS </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/erlang/ > Erlang </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/erts/ > ERTS </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/ets/ > ETS </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/evm/ > EVM </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/mnesia/ > Mnesia </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/otp/ > OTP </a>&ensp;<a class="tag light-blue lighten-2 white-text" href=https://www.insight-it.ru/tag/vm/ > VM </a>&ensp;</div></footer></article></section></div><div class=after><div id=comments></div><script type=text/javascript>
        var disqus_shortname = 'insight-it';
        var disqus_identifier = '1722 http://www.insight-it.ru/?p=1722';
        var disqus_url = 'https://www.insight-it.ru/erlang/2012/erlang-v-internet-proektakh/';
        var disqus_domain = 'disqus.com';
        var disqus_title = 'Erlang в интернет-проектах';
        var disqus_container_id = 'comments';
        (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//insight-it.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script></div></div><div class="col hide-on-small-only m3 l2"><div class=card><a href=https://www.insight-it.ru/author><div class="card-image tooltipped" data-position=top data-delay=50 data-tooltip="Автор Insight IT"><img src=https://www.insight-it.ru/images/avatar.jpeg><span class=card-title>Иван Блинков</span></div></a></div><div class=toc-wrapper><div style="height: 1px;"><ul class="section table-of-contents"><li><a href=# title="Erlang в интернет-проектах">Erlang в интернет-проектах</a><li><a href=#chto-takoe-erlang title="Что такое Erlang?">Что такое Erlang?</a></li><li><a href=#kliuchevye-osobennosti title="Ключевые особенности">Ключевые особенности</a></li><li><a href=#primenenie-na-praktike title="Применение на практике">Применение на практике</a><li><a href=#vkhodiashchie-polzovatelskie-soedineniia title="Входящие пользовательские соединения">Входящие пользовательские соединения</a></li><li><a href=#otdacha-statiki title="Отдача статики">Отдача статики</a></li><li><a href=#balansirovka-nagruzki title="Балансировка нагрузки">Балансировка нагрузки</a></li><li><a href=#broker-soobshchenii title="Брокер сообщений">Брокер сообщений</a></li><li><a href=#biznes-logika title=Бизнес-логика>Бизнес-логика</a></li><li><a href=#bazy-dannykh title="Базы данных">Базы данных</a></li></li><li><a href=#podvodim-itogi_1 title="Подводим итоги">Подводим итоги</a></li></li></ul></div></div></div></div></div></main><footer class=page-footer><div id=footer class=container><div class=row><div class="col m4 s12"><h5 class=white-text>Иван Блинков</h5><ul><li><a href=mailto:insight-it@blinkov.ru rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-mail white-text"></i> insight-it@blinkov.ru </span></a></li><li><a href=https://www.linkedin.com/in/ivanblinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-linkedin light-blue-text text-darken-3"></i> LinkedIn </span></a></li><li><a href=https://twitter.com/blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-twitter cyan-text text-accent-2"></i> @blinkov </span></a></li><li><a href="http://plus.google.com/102882395551389724078?rel=author" rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-gplus red-text"></i> Google </span></a></li><li><a href=https://www.facebook.com/ivan.blinkov rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-facebook blue-text text-darken-3"></i> Facebook </span></a></li><li><a href=https://www.insight-it.ru/feed/ rel=nofollow><span class="light-blue-text text-lighten-4"><i class="icon-rss orange-text"></i> Подписаться по RSS </span></a></li></ul><a href=//feeds.feedburner.com/insight-it/feed target=_blank rel="external nofollow"><img src="//feeds.feedburner.com/~fc/insight-it/feed?bg=b3e5fc&amp;fg=222222&amp;anim=1" height=26 width=88></a>&nbsp;<a href=//twitter.com/blinkov target=_blank rel="external nofollow"><img src=//button.twittercounter.com/animated/blinkov/222222/b3e5fc width=88 height=26></a></div><div class="col m4 s12"><h5 class=white-text>Рубрики</h5><ul><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/highload/ > Высокие нагрузки </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/interactive/ > Интерактивные сайты </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/linux/ > Linux </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/python/ > Python </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/erlang/ > Erlang </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/storage/ > Хранение данных </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/frontend/ > Frontend </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/theory/ > Теория </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/event/ > Мероприятия </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/misc/ > Разное </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/php/ > PHP </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/security/ > Безопасность </a></li><li><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/category/vacancy/ > Вакансии </a></li></ul><h5 class=white-text>Навигация</h5><ul><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/blog/ >Блог</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/about/ >О&nbsp;сайте</a></li><li class><a rel=nofollow class="grey-text text-lighten-4" href=https://www.insight-it.ru/author/ >Об&nbsp;авторе</a></li></ul></div><div class="col m4 s12"><h5 class="white-text center-align">Теги</h5><div class="tagcloud taglist"><span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/programmirovanie/ > Программирование </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/php/ > PHP </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/memcached/ > Memcached </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/internet/ > интернет </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hadoop/ > Hadoop </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/arkhitektura/ > архитектура </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/informatsionnye-tekhnologii/ > информационные технологии </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/nginx/ > nginx </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/online/ > online </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/linux/ > Linux </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/javascript/ > JavaScript </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/java/ > Java </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/facebook/ > Facebook </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/razrabotka/ > разработка </a></span>&ensp;<span class="tag light-blue lighten-2 tag-2"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/mysql/ > MySQL </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/apache/ > Apache </a></span>&ensp;<span class="tag light-blue lighten-2 tag-1"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/masshtabiruemost/ > Масштабируемость </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/python/ > Python </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/highload/ > highload </a></span>&ensp;<span class="tag light-blue lighten-2 tag-3"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/c/ > C++ </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/meropriiatiia/ > мероприятия </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/oop/ > ООП </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/google/ > Google </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/hbase/ > HBase </a></span>&ensp;<span class="tag light-blue lighten-2 tag-4"><a rel=nofollow class=white-text href=https://www.insight-it.ru/tag/tekhnologiia/ > технология </a></span>&ensp;</div></div></div></div><div class=footer-copyright><div class=container> © Insight IT, 2008-2015 <a class="license right tooltipped" rel="license nofollow" target=_blank href=http://creativecommons.org/licenses/by-nc-nd/4.0/ data-position=top data-delay=50 data-tooltip="Все материалы опубликованы под лицензией Creative Commons Attribution-NonCommercial-NoDerivatives 4.0"><img alt="Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License" src=https://www.insight-it.ru/theme/images/license.png></a></div></div></footer><script src=//code.jquery.com/jquery-2.1.1.min.js></script><script src=https://www.insight-it.ru/theme/js/main.js?b5bb290d></script><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js ','ga');
ga('create', 'UA-3403373-1', 'auto');
ga('send', 'pageview');
</script></body></html>